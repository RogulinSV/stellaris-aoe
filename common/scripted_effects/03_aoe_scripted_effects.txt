engage_intelligencer_espionage_purpose_disclose_spies = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_disclose_spies"
        log = ">>> engage_intelligencer_espionage_purpose_disclose_spies effect: pop was engaged for disclose spies"
    }
}

engage_intelligencer_espionage_purpose_steal_resources = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_steal_resources"
        log = ">>> engage_intelligencer_espionage_purpose_steal_resources effect: pop was engaged for stealing resources"
    }
}

engage_intelligencer_espionage_purpose_steal_technologies = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_steal_technologies"
        log = ">>> engage_intelligencer_espionage_purpose_steal_technologies effect: pop was engaged for stealing technologies"
    }
}

engage_intelligencer_espionage_purpose_recruit_defector = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_recruit_defector"
        log = ">>> engage_intelligencer_espionage_purpose_recruit_defector effect: pop was engaged for recruit defector"
    }
}

engage_intelligencer_espionage_purpose_commit_sabotage = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_commit_sabotage"
        log = ">>> engage_intelligencer_espionage_purpose_commit_sabotage effect: pop was engaged for commit sabotage"
    }
}

engage_intelligencer_espionage_purpose_broadcast_propaganda = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_broadcast_propaganda"
        log = ">>> engage_intelligencer_espionage_purpose_broadcast_propaganda effect: pop was engaged for broadcast propaganda"
    }
}

disengage_intelligencer = {
    event_target:espionage_origin_spy = {
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_disclose_spies"
            }
            remove_pop_flag = "espionage_purpose_disclose_spies"
            log = ">>> disengage_intelligencer effect: pop was disengaged from disclose spies"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_steal_resources"
            }
            remove_pop_flag = "espionage_purpose_steal_resources"
            log = ">>> disengage_intelligencer effect: pop was disengaged from stealing resources"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_steal_technologies"
            }
            remove_pop_flag = "espionage_purpose_steal_technologies"
            log = ">>> disengage_intelligencer effect: pop was disengaged from stealing technologies"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_recruit_defector"
            }
            remove_pop_flag = "espionage_purpose_recruit_defector"
            log = ">>> disengage_intelligencer effect: pop was disengaged from recruit defector"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_commit_sabotage"
            }
            remove_pop_flag = "espionage_purpose_commit_sabotage"
            log = ">>> disengage_intelligencer effect: pop was disengaged from commit sabotage"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_broadcast_propaganda"
            }
            remove_pop_flag = "espionage_purpose_broadcast_propaganda"
            log = ">>> disengage_intelligencer effect: pop was disengaged from broadcast propaganda"
        }
    }
}

set_intelligencer_on_assignment = {
    event_target:espionage_origin_spy = {
        set_timed_pop_flag = {
            flag = "intelligencer_on_assignment"
            days = $ARG1$
        }
        log = ">>> set_intelligencer_on_assignment effect: pop was assigned for espionage action"
    }
}

revoke_intelligencer_from_assignment = {
    event_target:espionage_origin_spy = {
        if = {
            limit = {
                has_pop_flag = "intelligencer_on_assignment"
            }
            remove_pop_flag = "intelligencer_on_assignment"
            log = ">>> revoke_intelligencer_from_assignment effect: pop was revoked from espionage action"
        }
    }
}

# Scope: pop
promote_intelligencer = {
    if = {
        limit = {
            NOR = {
                pop_has_trait = "trait_intelligencer_neophyte"
                pop_has_trait = "trait_intelligencer_acolyte"
                pop_has_trait = "trait_intelligencer_adept"
                pop_has_trait = "trait_intelligencer_master"
                pop_has_trait = "trait_intelligencer_prophet"
            }
        }
        modify_species = {
            species = this
            add_trait = "trait_intelligencer_neophyte"
        }
    }
    else_if = {
        limit = {
            pop_has_trait = "trait_intelligencer_neophyte"
            NOR = {
                pop_has_trait = "trait_intelligencer_acolyte"
                pop_has_trait = "trait_intelligencer_adept"
                pop_has_trait = "trait_intelligencer_master"
                pop_has_trait = "trait_intelligencer_prophet"
            }
        }
        modify_species = {
            species = this
            remove_trait = "trait_intelligencer_neophyte"
        }
        modify_species = {
            species = this
            add_trait = "trait_intelligencer_acolyte"
        }
    }
    else_if = {
        limit = {
            pop_has_trait = "trait_intelligencer_acolyte"
            NOR = {
                pop_has_trait = "trait_intelligencer_adept"
                pop_has_trait = "trait_intelligencer_master"
                pop_has_trait = "trait_intelligencer_prophet"
            }
        }
        modify_species = {
            species = this
            remove_trait = "trait_intelligencer_acolyte"
        }
        modify_species = {
            species = this
            add_trait = "trait_intelligencer_adept"
        }
    }
    else_if = {
        limit = {
            pop_has_trait = "trait_intelligencer_adept"
            NOR = {
                pop_has_trait = "trait_intelligencer_master"
                pop_has_trait = "trait_intelligencer_prophet"
            }
        }
        modify_species = {
            species = this
            remove_trait = "trait_intelligencer_adept"
        }
        modify_species = {
            species = this
            add_trait = "trait_intelligencer_master"
        }
    }
    else_if = {
        limit = {
            pop_has_trait = "trait_intelligencer_master"
            NOT = {
                pop_has_trait = "trait_intelligencer_prophet"
            }
        }
        modify_species = {
            species = this
            remove_trait = "trait_intelligencer_master"
        }
        modify_species = {
            species = this
            add_trait = "trait_intelligencer_prophet"
        }
    }
}

gather_intelligence_data = {
    event_target:espionage_target_country = {
        set_variable = {
            which = "espionage_data_ship_corvette_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_ship_destroyer_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_ship_cruiser_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_ship_battleship_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_ship_colossus_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_transport_ship_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_military_fleet_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_military_station_fleet_count"
            value = 0
        }
        set_variable = {
            which = "espionage_data_transport_fleet_count"
            value = 0
        }

        every_owned_ship = {
            if = {
                limit = {
                    is_ship_class = "shipclass_military"
                }
                switch = {
                    trigger = is_ship_size
                    corvette = {
                        prev = {
                            change_variable = {
                                which = "espionage_data_ship_corvette_count"
                                value = 1
                            }
                        }
                    }
                    destroyer = {
                        prev = {
                            change_variable = {
                                which = "espionage_data_ship_destroyer_count"
                                value = 1
                            }
                        }
                    }
                    cruiser = {
                        prev = {
                            change_variable = {
                                which = "espionage_data_ship_cruiser_count"
                                value = 1
                            }
                        }
                    }
                    battleship = {
                        prev = {
                            change_variable = {
                                which = "espionage_data_ship_battleship_count"
                                value = 1
                            }
                        }
                    }
                    colossus = {
                        prev = {
                            change_variable = {
                                which = "espionage_data_ship_colossus_count"
                                value = 1
                            }
                        }
                    }
                }
            }
        }
        every_owned_ship = {
            if = {
                limit = {
                    is_ship_class = "shipclass_transport"
                }
                prev = {
                    change_variable = {
                        which = "espionage_data_transport_ship_count"
                        value = 1
                    }
                }
            }
        }
        every_owned_fleet = {
            limit = {
                is_ship_class = "shipclass_military"
            }
            prev = {
                change_variable = {
                    which = "espionage_data_military_fleet_count"
                    value = 1
                }
            }
        }
        every_owned_fleet = {
            limit = {
                is_ship_class = "shipclass_military_station"
            }
            prev = {
                change_variable = {
                    which = "espionage_data_military_station_fleet_count"
                    value = 1
                }
            }
        }
        every_owned_fleet = {
            limit = {
                is_ship_class = "shipclass_transport"
            }
            prev = {
                change_variable = {
                    which = "espionage_data_transport_fleet_count"
                    value = 1
                }
            }
        }
    }

    event_target:espionage_origin_country = {
        country_event = {
            id = aoe_espionage_actions.24
        }
    }
}