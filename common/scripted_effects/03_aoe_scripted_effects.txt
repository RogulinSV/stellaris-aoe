engage_intelligencer_espionage_purpose_disclose_spies = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_disclose_spies"
        log = ">>> engage_intelligencer_espionage_purpose_disclose_spies effect: pop was engaged for disclose spies"
    }
}

engage_intelligencer_espionage_purpose_steal_resources = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_steal_resources"
        log = ">>> engage_intelligencer_espionage_purpose_steal_resources effect: pop was engaged for stealing resources"
    }
}

engage_intelligencer_espionage_purpose_steal_technologies = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_steal_technologies"
        log = ">>> engage_intelligencer_espionage_purpose_steal_technologies effect: pop was engaged for stealing technologies"
    }
}

engage_intelligencer_espionage_purpose_recruit_defector = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_recruit_defector"
        log = ">>> engage_intelligencer_espionage_purpose_recruit_defector effect: pop was engaged for recruit defector"
    }
}

engage_intelligencer_espionage_purpose_commit_sabotage = {
    event_target:espionage_origin_spy = {
        set_pop_flag = "espionage_purpose_commit_sabotage"
        log = ">>> engage_intelligencer_espionage_purpose_commit_sabotage effect: pop was engaged for commit sabotage"
    }
}


disengage_intelligencer = {
    event_target:espionage_origin_spy = {
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_disclose_spies"
            }
            remove_pop_flag = "espionage_purpose_disclose_spies"
            log = ">>> disengage_intelligencer effect: pop was disengaged from disclose spies"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_steal_resources"
            }
            remove_pop_flag = "espionage_purpose_steal_resources"
            log = ">>> disengage_intelligencer effect: pop was disengaged from stealing resources"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_steal_technologies"
            }
            remove_pop_flag = "espionage_purpose_steal_technologies"
            log = ">>> disengage_intelligencer effect: pop was disengaged from stealing technologies"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_recruit_defector"
            }
            remove_pop_flag = "espionage_purpose_recruit_defector"
            log = ">>> disengage_intelligencer effect: pop was disengaged from recruit defector"
        }
        if = {
            limit = {
                has_pop_flag = "espionage_purpose_commit_sabotage"
            }
            remove_pop_flag = "espionage_purpose_commit_sabotage"
            log = ">>> disengage_intelligencer effect: pop was disengaged from commit sabotage"
        }
    }
}

set_intelligencer_on_assignment = {
    event_target:espionage_origin_spy = {
        set_timed_pop_flag = {
            flag = "intelligencer_on_assignment"
            days = $ARG1$
        }
        log = ">>> set_intelligencer_on_assignment effect: pop was assigned for espionage action"
    }
}

revoke_intelligencer_from_assignment = {
    event_target:espionage_origin_spy = {
        if = {
            limit = {
                has_pop_flag = "intelligencer_on_assignment"
            }
            remove_pop_flag = "intelligencer_on_assignment"
            log = ">>> revoke_intelligencer_from_assignment effect: pop was revoked from espionage action"
        }
    }
}

count_espionage_subjects = {
    event_target:espionage_origin_country = {
        set_variable = {
            which = "possibly_affected_by_espionage_counter"
            value = 1
        }
    }
    every_country = {
        limit = {
            is_subject_of_espionage = yes
        }
        event_target:espionage_origin_country = {
            change_variable = {
                which = "possibly_affected_by_espionage_counter"
                value = 1
            }
        }
    }
    log = ">>> count_espionage_subjects effect: countries was counted as possible espionage subject"
}

find_espionage_subject = {
    random_country = {
        limit = {
            is_subject_of_espionage = yes
        }
        set_timed_country_flag = {
            flag = espionage_target_country@event_target:espionage_origin_country
            days = 3
        }
        save_event_target_as = "espionage_target_country"
        log = ">>> find_espionage_subject effect: country was selected as espionage subject"
    }
}