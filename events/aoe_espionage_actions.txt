namespace = aoe_espionage_actions

planet_event = {
    id = aoe_espionage_actions.1
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        any_pop = {
            is_unassignment_intelligencer = yes
        }
        NOR = {
            has_modifier = "planet_intelligencer_training"
            has_modifier = "planet_intelligencer_disclosing"
        }
    }

    immediate = {
        random_pop = {
            limit = {
                is_unassignment_intelligencer = yes
            }
            # weights = {
            #     base = 1
            #     modifier = {
            #         mult = 2
            #         is_intelligencer_has_rank_1 = yes
            #     }
                # modifier = {
                #     mult = 4
                #     is_intelligencer_has_rank_2 = yes
                # }
                # modifier = {
                #     mult = 6
                #     is_intelligencer_has_rank_3 = yes
                # }
                # modifier = {
                #     mult = 8
                #     is_intelligencer_has_rank_4 = yes
                # }
                # modifier = {
                #     mult = 10
                #     is_intelligencer_has_rank_5 = yes
                # }
            # }
            save_event_target_as = "espionage_origin_spy"
        }
        owner = {
            save_event_target_as = "espionage_origin_country"
        }
        save_event_target_as = "espionage_origin_planet"

        disengage_intelligencer = yes

        if = {
            limit = {
                has_building = "building_intelligence_agency_1"
            }
            add_modifier = {
                modifier = "planet_intelligencer_training"
                days = 300
            }
            owner = {
                country_event = {
                    id = aoe_espionage_actions.2
                    days = 200
                    random = 90
                }
            }
        }
        else_if = {
            limit = {
                has_building = "building_intelligence_agency_2"
            }
            add_modifier = {
                modifier = "planet_intelligencer_training"
                days = 200
            }
            owner = {
                country_event = {
                    id = aoe_espionage_actions.2
                    days = 130
                    random = 60
                }
            }
        }
        else_if = {
            limit = {
                has_building = "building_intelligence_agency_3"
            }
            add_modifier = {
                modifier = "planet_intelligencer_training"
                days = 100
            }
            owner = {
                country_event = {
                    id = aoe_espionage_actions.2
                    days = 60
                    random = 30
                }
            }
        }
    }
}

country_event = {
    id = aoe_espionage_actions.2
    title = aoe_espionage_actions.2.title
    show_sound = event_administrative_work
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = {
        portrait = root
        planet_background = root
        graphical_culture = root
        city_level = root
        room = root.ruler
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_not_ranked = yes
            }
        }
        text = aoe_espionage_actions.2.desc_01
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_1 = yes
            }
        }
        text = aoe_espionage_actions.2.desc_02
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_2 = yes
            }
        }
        text = aoe_espionage_actions.2.desc_03
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_3 = yes
            }
        }
        text = aoe_espionage_actions.2.desc_04
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_4 = yes
            }
        }
        text = aoe_espionage_actions.2.desc_05
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_5 = yes
            }
        }
        text = aoe_espionage_actions.2.desc_06
    }

    trigger = {
        exists = event_target:espionage_origin_country
        exists = event_target:espionage_origin_planet
        exists = event_target:espionage_origin_spy
        event_target:espionage_origin_planet = {
            owner = {
                is_same_value = event_target:espionage_origin_country
            }
            any_pop = {
                is_same_value = event_target:espionage_origin_spy
            }
        }
        event_target:espionage_origin_spy = {
            is_unassignment_intelligencer = yes
            is_disengaged_intelligencer = yes
        }
        any_country = {
            is_subject_of_espionage = yes
        }
    }

    option = {
        name = "aoe_espionage_actions.2.a"
        custom_tooltip = "aoe_espionage_actions.2.a.tooltip"
        trigger = {
            resource_stockpile_compare = {
                resource = minerals
                value >= 200
            }
        }
        add_resource = {
            minerals = -200
        }
        hidden_effect = {
            engage_intelligencer_espionage_purpose_steal_resources = yes
            find_espionage_subject = yes
            country_event = {
                id = aoe_espionage_actions.3
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.2.b"
        custom_tooltip = "aoe_espionage_actions.2.b.tooltip"
        trigger = {
            resource_stockpile_compare = {
                resource = minerals
                value >= 300
            }
        }
        add_resource = {
            minerals = -300
        }
        hidden_effect = {
            engage_intelligencer_espionage_purpose_steal_technologies = yes
            find_espionage_subject = yes
            country_event = {
                id = aoe_espionage_actions.3
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.2.c"
        custom_tooltip = "aoe_espionage_actions.2.c.tooltip"
        trigger = {
            resource_stockpile_compare = {
                resource = minerals
                value >= 400
            }
            resource_stockpile_compare = {
                resource = influence
                value >= 25
            }
        }
        add_resource = {
            minerals = -400
            influence = -25
        }
        hidden_effect = {
            engage_intelligencer_espionage_purpose_recruit_defector = yes
            find_espionage_subject = yes
            country_event = {
                id = aoe_espionage_actions.3
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.2.d"
        custom_tooltip = "aoe_espionage_actions.2.d.tooltip"
        trigger = {
            resource_stockpile_compare = {
                resource = minerals
                value >= 500
            }
            resource_stockpile_compare = {
                resource = energy
                value >= 500
            }
        }
        add_resource = {
            minerals = -500
            energy = -500
        }
        hidden_effect = {
            engage_intelligencer_espionage_purpose_commit_sabotage = yes
            find_espionage_subject = yes
            country_event = {
                id = aoe_espionage_actions.3
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.2.y"
        custom_tooltip = "aoe_espionage_actions.2.y.tooltip"
        trigger = {
            resource_stockpile_compare = {
                resource = minerals
                value >= 100
            }
            resource_stockpile_compare = {
                resource = unity
                value >= 5
            }
        }
        add_resource = {
            minerals = -100
            unity = -5
        }
        hidden_effect = {
            engage_intelligencer_espionage_purpose_disclose_spies = yes
            if = {
                limit = {
                    event_target:espionage_origin_planet = {
                        has_building = "building_intelligence_agency_2"
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 500
                }
            }
            else_if = {
                limit = {
                    event_target:espionage_origin_planet = {
                        has_building = "building_intelligence_agency_3"
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 700
                }
            }
            else = {
                set_intelligencer_on_assignment = {
                    ARG1 = 300
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.2.z"
        custom_tooltip = "aoe_espionage_actions.2.z.tooltip"
    }
}

country_event = {
    id = aoe_espionage_actions.3
    title = aoe_espionage_actions.3.title
    desc = aoe_espionage_actions.3.desc
    show_sound = event_scanner
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = {
        portrait = event_target:espionage_target_country
        planet_background = event_target:espionage_target_country
        graphical_culture = event_target:espionage_target_country
        city_level = event_target:espionage_target_country
        room = event_target:espionage_target_country.ruler
    }

    trigger = {
        exists = event_target:espionage_origin_country
        exists = event_target:espionage_origin_planet
        exists = event_target:espionage_origin_spy
        exists = event_target:espionage_target_country
        event_target:espionage_origin_planet = {
            owner = {
                is_same_value = event_target:espionage_origin_country
            }
            any_pop = {
                is_same_value = event_target:espionage_origin_spy
            }
        }
        event_target:espionage_origin_spy = {
            is_unassignment_intelligencer = yes
            is_engaged_intelligencer = yes
        }
        # event_target:espionage_target_country = {
        #     is_subject_of_espionage = yes
        # }
    }

    immediate = {
        count_espionage_subjects = yes
        event_target:espionage_target_country = {
            random_owned_planet = {
                limit = {
                    is_possible_ground_espionage = yes
                }
                save_event_target_as = "espionage_target_planet"
                log = ">>> espionage_actions.3: [Root.GetName] chose the planet [This.GetName] for espionage action"
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.3.a"
        custom_tooltip = "aoe_espionage_actions.3.a.tooltip"
        trigger = {
            event_target:espionage_origin_planet = {
                has_building = "building_intelligence_agency_1"
            }
        }
        hidden_effect = {
            if = {
                limit = {
                    event_target:espionage_target_country = {
                        is_at_war_with = root
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 10
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 9
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 9
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 9
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 9-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
            else_if = {
                limit = {
                    event_target:espionage_target_country = {
                        has_closed_borders = root
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 9
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 8
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 8
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 8
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 8-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
            else = {
                set_intelligencer_on_assignment = {
                    ARG1 = 8
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 7
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 7
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 7
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 7-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.3.b"
        custom_tooltip = "aoe_espionage_actions.3.b.tooltip"
        trigger = {
            event_target:espionage_origin_planet = {
                has_building = "building_intelligence_agency_2"
            }
        }
        hidden_effect = {
            if = {
                limit = {
                    event_target:espionage_target_country = {
                        is_at_war_with = root
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 7
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 6
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 6
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 6
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 6-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
            else_if = {
                limit = {
                    event_target:espionage_target_country = {
                        has_closed_borders = root
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 6
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 5
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 5
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 5
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 5-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
            else = {
                set_intelligencer_on_assignment = {
                    ARG1 = 5
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 4
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 4
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 4
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 4-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.3.c"
        custom_tooltip = "aoe_espionage_actions.3.c.tooltip"
        trigger = {
            event_target:espionage_origin_planet = {
                has_building = "building_intelligence_agency_3"
            }
        }
        hidden_effect = {
            if = {
                limit = {
                    event_target:espionage_target_country = {
                        is_at_war_with = root
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 4
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 3
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 3
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 3
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 3-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
            else_if = {
                limit = {
                    event_target:espionage_target_country = {
                        has_closed_borders = root
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 3
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 2
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 2
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 2
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 2-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
            else = {
                set_intelligencer_on_assignment = {
                    ARG1 = 2
                }
                event_target:espionage_origin_country = {
                    country_event = {
                        id = aoe_espionage_actions.4
                        days = 1
                    }
                }
                event_target:espionage_target_planet = {
                    set_timed_planet_flag = {
                        flag = "espionage_target_planet"
                        days = 1
                    }
                    set_timed_planet_flag = {
                        flag = espionage_target_planet@root
                        days = 1
                    }
                }
                log = ">>> espionage_actions.3: [Root.GetName] began 1-day operation on the planet [event_target:espionage_target_planet.GetName]"
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.3.d"
        custom_tooltip = "aoe_espionage_actions.3.d.tooltip"
        trigger = {
            any_country = {
                is_subject_of_espionage = yes
            }
        }
        hidden_effect = {
            find_espionage_subject = yes
            country_event = {
                id = aoe_espionage_actions.3
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.3.e"
        custom_tooltip = "aoe_espionage_actions.3.e.tooltip"
    }
}

country_event = {
    id = aoe_espionage_actions.4
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        exists = event_target:espionage_origin_country
        exists = event_target:espionage_origin_planet
        exists = event_target:espionage_origin_spy
        exists = event_target:espionage_target_country
        event_target:espionage_origin_planet = {
            owner = {
                is_same_value = event_target:espionage_origin_country
            }
        }
        event_target:espionage_origin_spy = {
            is_appointed_intelligencer = yes
            is_engaged_intelligencer = yes
        }
        event_target:espionage_target_country = {
            is_subject_of_espionage = yes
        }
    }

    immediate = {
        # Try steal resources
        if = {
            limit = {
                event_target:espionage_origin_spy = {
                    is_intelligencer_has_purpose_steal_resources = yes
                }
            }
            random_list = {
                10 = {
                    modifier = {
                        factor = 10
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            has_closed_borders = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_at_war_with = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            OR = {
                                is_authoritarian = yes
                                is_xenophobe = yes
                                has_ethic = "ethic_gestalt_consciousness"
                            }
                        }
                    }
                    modifier = {
                        factor = 0.5
                        event_target:espionage_target_country = {
                            is_xenophile = yes
                        }
                    }
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] unable to stole resources and was exposed"
                }
                100 = {
                    modifier = {
                        factor = 1.05
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_1 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.1
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_2 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.15
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_3 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_4 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.25
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_5 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    try_steal_resources = yes
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] stole resources but was exposed"
                }
                80 = {
                    modifier = {
                        factor = 1.1
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_1 = yes
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_2 = yes
                        }
                    }
                    modifier = {
                        factor = 1.3
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_3 = yes
                        }
                    }
                    modifier = {
                        factor = 1.4
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_4 = yes
                        }
                    }
                    modifier = {
                        factor = 1.5
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_5 = yes
                        }
                    }
                    try_steal_resources = yes
                    log = ">>> espionage_actions.4: [This.GetName] stole resources"
                }
                20 = {
                    modifier = {
                        factor = 0
                        event_target:espionage_origin_spy = {
                            is_intelligencer_top_ranked = yes
                        }
                    }
                    try_steal_resources = yes
                    # Promote spy
                    country_event = {
                        id = aoe_espionage_actions.11
                        days = 5
                        random = 4
                    }
                    log = ">>> espionage_actions.4: [This.GetName] stole resources and will be promoted"
                }
            }
        }
        # Try steal technologies
        else_if = {
            limit = {
                event_target:espionage_origin_spy = {
                    is_intelligencer_has_purpose_steal_technologies = yes
                }
            }
            random_list = {
                10 = {
                    modifier = {
                        factor = 10
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            has_closed_borders = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_at_war_with = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            OR = {
                                is_authoritarian = yes
                                is_xenophobe = yes
                                has_ethic = "ethic_gestalt_consciousness"
                            }
                        }
                    }
                    modifier = {
                        factor = 0.5
                        event_target:espionage_target_country = {
                            is_xenophile = yes
                        }
                    }
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] unable to stole technologies and was exposed"
                }
                100 = {
                    modifier = {
                        factor = 1.05
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_1 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.1
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_2 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.15
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_3 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_4 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.25
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_5 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    try_steal_technologies = yes
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] stole technologies but was exposed"
                }
                80 = {
                    modifier = {
                        factor = 1.1
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_1 = yes
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_2 = yes
                        }
                    }
                    modifier = {
                        factor = 1.3
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_3 = yes
                        }
                    }
                    modifier = {
                        factor = 1.4
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_4 = yes
                        }
                    }
                    modifier = {
                        factor = 1.5
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_5 = yes
                        }
                    }
                    try_steal_technologies = yes
                    log = ">>> espionage_actions.4: [This.GetName] stole technologies"
                }
                20 = {
                    modifier = {
                        factor = 0
                        event_target:espionage_origin_spy = {
                            is_intelligencer_top_ranked = yes
                        }
                    }
                    try_steal_technologies = yes
                    # Promote spy
                    country_event = {
                        id = aoe_espionage_actions.11
                        days = 5
                        random = 4
                    }
                    log = ">>> espionage_actions.4: [This.GetName] stole technologies and will be promoted"
                }
            }
        }
        # Try recruit defector
        else_if = {
            limit = {
                event_target:espionage_origin_spy = {
                    is_intelligencer_has_purpose_recruit_defector = yes
                }
            }
            random_list = {
                10 = {
                    modifier = {
                        factor = 10
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            has_closed_borders = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_at_war_with = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            OR = {
                                is_authoritarian = yes
                                is_xenophobe = yes
                                has_ethic = "ethic_gestalt_consciousness"
                            }
                        }
                    }
                    modifier = {
                        factor = 0.5
                        event_target:espionage_target_country = {
                            is_xenophile = yes
                        }
                    }
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] unable to recruit defector and was exposed"
                }
                100 = {
                    modifier = {
                        factor = 1.05
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_1 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.1
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_2 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.15
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_3 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_4 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.25
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_5 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    try_recruit_defector = yes
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] recruit defector but was exposed"
                }
                80 = {
                    modifier = {
                        factor = 1.1
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_1 = yes
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_2 = yes
                        }
                    }
                    modifier = {
                        factor = 1.3
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_3 = yes
                        }
                    }
                    modifier = {
                        factor = 1.4
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_4 = yes
                        }
                    }
                    modifier = {
                        factor = 1.5
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_5 = yes
                        }
                    }
                    try_recruit_defector = yes
                    log = ">>> espionage_actions.4: [This.GetName] recruit defector"
                }
                20 = {
                    modifier = {
                        factor = 0
                        event_target:espionage_origin_spy = {
                            is_intelligencer_top_ranked = yes
                        }
                    }
                    try_recruit_defector = yes
                    # Promote spy
                    country_event = {
                        id = aoe_espionage_actions.11
                        days = 5
                        random = 4
                    }
                    log = ">>> espionage_actions.4: [This.GetName] recruit defector and will be promoted"
                }
            }
        }
        # Try commit sabotage
        else_if = {
            limit = {
                event_target:espionage_origin_spy = {
                    is_intelligencer_has_purpose_commit_sabotage = yes
                }
            }
            random_list = {
                10 = {
                    modifier = {
                        factor = 10
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            has_closed_borders = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_at_war_with = root
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            OR = {
                                is_authoritarian = yes
                                is_xenophobe = yes
                                has_ethic = "ethic_gestalt_consciousness"
                            }
                        }
                    }
                    modifier = {
                        factor = 0.5
                        event_target:espionage_target_country = {
                            is_xenophile = yes
                        }
                    }
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] unable to commit sabotage and was exposed"
                }
                100 = {
                    modifier = {
                        factor = 1.05
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_1 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.1
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_2 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.15
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_3 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_4 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 1.25
                        event_target:espionage_target_planet = {
                            any_pop = {
                                is_intelligencer_has_purpose_disclose_spies = yes
                                is_appointed_intelligencer = yes
                                is_intelligencer_has_rank_5 = yes
                            }
                        }
                    }
                    modifier = {
                        factor = 2
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    try_commit_sabotage = yes
                    # We are exposed by the victim
                    country_event = {
                        id = aoe_espionage_actions.6
                        days = 1
                    }
                    log = ">>> espionage_actions.4: [This.GetName] commit sabotage but was exposed"
                }
                80 = {
                    modifier = {
                        factor = 1.1
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_1 = yes
                        }
                    }
                    modifier = {
                        factor = 1.2
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_2 = yes
                        }
                    }
                    modifier = {
                        factor = 1.3
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_3 = yes
                        }
                    }
                    modifier = {
                        factor = 1.4
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_4 = yes
                        }
                    }
                    modifier = {
                        factor = 1.5
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_5 = yes
                        }
                    }
                    try_commit_sabotage = yes
                    log = ">>> espionage_actions.4: [This.GetName] commit sabotage"
                }
                20 = {
                    modifier = {
                        factor = 0
                        event_target:espionage_origin_spy = {
                            is_intelligencer_top_ranked = yes
                        }
                    }
                    try_commit_sabotage = yes
                    # Promote spy
                    country_event = {
                        id = aoe_espionage_actions.11
                        days = 5
                        random = 4
                    }
                    log = ">>> espionage_actions.4: [This.GetName] commit sabotage and will be promoted"
                }
            }
        }
    }
}

country_event = {
    id = aoe_espionage_actions.5
    title = aoe_espionage_actions.5.title
    show_sound = event_red_alert
    diplomatic = yes
    is_triggered_only = yes

    picture_event_data = {
        portrait = event_target:espionage_origin_country
        planet_background = event_target:espionage_origin_country
        graphical_culture = event_target:espionage_origin_country
        city_level = event_target:espionage_origin_country
        room = event_target:espionage_origin_country.ruler
    }

    # They are apologized
    desc = {
        trigger = {
            NOT = {
                has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
            }
        }
        text = aoe_espionage_actions.5.desc_01
    }

    # They are not apologized
    desc = {
        trigger = {
            has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
        }
        text = aoe_espionage_actions.5.desc_02
    }

    trigger = {
        exists = event_target:espionage_origin_country
        exists = event_target:espionage_origin_spy
    }

    # We can declare war
    option = {
        name = "aoe_espionage_actions.5.a"
        custom_tooltip = "aoe_espionage_actions.5.a.tooltip"
        trigger = {
            is_possible_declare_espionage_war = yes
            is_pacifist = no
        }
        ai_chance = {
            factor = 100
            modifier = {
                factor = 0.1
                relative_power = {
                    who = event_target:espionage_origin_country
                    category = fleet
                    value = pathetic
                }
            }
            modifier = {
                factor = 0.5
                OR = {
                    is_friendly_to = event_target:espionage_origin_country
                    is_cordial_to = event_target:espionage_origin_country
                    is_protective_to = event_target:espionage_origin_country
                    is_loyal_to = event_target:espionage_origin_country
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:espionage_origin_country
                    category = fleet
                    value = superior
                }
            }
            modifier = {
                factor = 5
                is_militarist = yes
            }
            modifier = {
                factor = 10
                OR = {
                    is_domineering_to = event_target:espionage_origin_country
                    is_unfriendly_to = event_target:espionage_origin_country
                    is_patronizing_to = event_target:espionage_origin_country
                    is_dismissive_to = event_target:espionage_origin_country
                    is_hostile_to = event_target:espionage_origin_country
                }
            }
            modifier = {
                factor = 100
                is_fallen_empire = yes
            }
        }
        add_threat = {
            who = event_target:espionage_origin_country
            amount = 10
        }
        add_opinion_modifier = {
            who = event_target:espionage_origin_country
            modifier = opinion_discarded
        }
        add_casus_belli = {
            type = cb_hunger
            who = event_target:espionage_origin_country
            days = 900
        }
        declare_war = {
            target = event_target:espionage_origin_country
            name = "NAME_Holy_World_War"
            attacker_war_goal = wg_absorption
        }
        hidden_effect = {
            random_list = {
                100 = {
                    modifier = {
                        factor = 0
                        NOT = {
                            exists = event_target:espionage_origin_spy
                        }
                    }
                    modifier = {
                        factor = 2
                        is_xenophobe = yes
                    }
                    modifier = {
                        factor = 0.2
                        is_xenophile = yes
                    }
                    modifier = {
                        factor = 0.9
                        exists = event_target:espionage_origin_spy
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_1 = yes
                        }
                    }
                    modifier = {
                        factor = 0.8
                        exists = event_target:espionage_origin_spy
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_2 = yes
                        }
                    }
                    modifier = {
                        factor = 0.7
                        exists = event_target:espionage_origin_spy
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_3 = yes
                        }
                    }
                    modifier = {
                        factor = 0.6
                        exists = event_target:espionage_origin_spy
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_4 = yes
                        }
                    }
                    modifier = {
                        factor = 0.5
                        exists = event_target:espionage_origin_spy
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_5 = yes
                        }
                    }
                    event_target:espionage_origin_country = {
                        country_event = {
                            id = aoe_espionage_actions.7
                            days = 1
                        }
                    }
                }
                50 = {}
            }
        }
    }

    # We are xenophobe OR they not apologized
    option = {
        name = "aoe_espionage_actions.5.b"
        custom_tooltip = "aoe_espionage_actions.5.b.tooltip"
        trigger = {
            exists = event_target:espionage_origin_spy
            OR = {
                is_xenophobe = yes
                is_authoritarian = yes
                has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
            }
        }
        ai_chance = {
            factor = 100
            modifier = {
                factor = 0.1
                OR = {
                    is_xenophile = yes
                    is_spiritualist = yes
                }
            }
            modifier = {
                factor = 0.8
                OR = {
                    is_friendly_to = event_target:espionage_origin_country
                    is_cordial_to = event_target:espionage_origin_country
                    is_protective_to = event_target:espionage_origin_country
                    is_loyal_to = event_target:espionage_origin_country
                }
            }
            modifier = {
                factor = 5
                OR = {
                    is_domineering_to = event_target:espionage_origin_country
                    is_unfriendly_to = event_target:espionage_origin_country
                    is_patronizing_to = event_target:espionage_origin_country
                    is_dismissive_to = event_target:espionage_origin_country
                    is_hostile_to = event_target:espionage_origin_country
                }
            }
        }
        add_threat = {
            who = event_target:espionage_origin_country
            amount = 50
        }
        add_opinion_modifier = {
            who = event_target:espionage_origin_country
            modifier = opinion_discarded
        }
        hidden_effect = {
            random_list = {
                100 = {
                    modifier = {
                        factor = 0.9
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_1 = yes
                        }
                    }
                    modifier = {
                        factor = 0.8
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_2 = yes
                        }
                    }
                    modifier = {
                        factor = 0.7
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_3 = yes
                        }
                    }
                    modifier = {
                        factor = 0.6
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_4 = yes
                        }
                    }
                    modifier = {
                        factor = 0.5
                        event_target:espionage_origin_spy = {
                            is_intelligencer_has_rank_5 = yes
                        }
                    }
                    event_target:espionage_origin_country = {
                        country_event = {
                            id = aoe_espionage_actions.7
                            days = 1
                        }
                    }
                }
                50 = {}
            }
        }
    }

    # We are xenophile OR they are apologized
    option = {
        name = "aoe_espionage_actions.6.c"
        custom_tooltip = "aoe_espionage_actions.6.c.tooltip"
        trigger = {
            OR = {
                is_xenophile = yes
                is_spiritualist = yes
                NOT = {
                    has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
                }
            }
        }
        ai_chance = {
            factor = 100
            modifier = {
                factor = 0.1
                OR = {
                    is_xenophobe = yes
                    is_authoritarian = yes
                }
            }
            modifier = {
                factor = 0.1
                OR = {
                    is_domineering_to = event_target:espionage_origin_country
                    is_unfriendly_to = event_target:espionage_origin_country
                    is_patronizing_to = event_target:espionage_origin_country
                    is_dismissive_to = event_target:espionage_origin_country
                    is_hostile_to = event_target:espionage_origin_country
                }
            }
            modifier = {
                factor = 10
                OR = {
                    is_friendly_to = event_target:espionage_origin_country
                    is_cordial_to = event_target:espionage_origin_country
                    is_protective_to = event_target:espionage_origin_country
                    is_loyal_to = event_target:espionage_origin_country
                }
            }
        }
        add_threat = {
            who = event_target:espionage_origin_country
            amount = 100
        }
    }

    # Another...
    option = {
        name = "aoe_espionage_actions.6.d"
        custom_tooltip = "aoe_espionage_actions.6.d.tooltip"
        trigger = {
            is_ai = yes
        }
        ai_chance = {
            factor = 100
        }
        hidden_effect = {
            log = "aoe_espionage_actions.6: [Root.GetName] call random to [event_target:espionage_origin_country.GetName]"
            if = {
                # We are fallen empire
                limit = {
                    is_fallen_empire = yes
                }
                if = {
                    limit = {
                        NOT = {
                            has_casus_belli = {
                                target = event_target:espionage_origin_country
                                type = cb_hunger
                            }
                        }
                    }
                    add_casus_belli = {
                        type = cb_hunger
                        who = event_target:espionage_origin_country
                        days = 900
                    }
                }
                if = {
                    limit = {
                        is_possible_declare_espionage_war = yes
                    }
                    declare_war = {
                        target = event_target:espionage_origin_country
                        name = "NAME_Holy_World_War"
                        attacker_war_goal = wg_absorption_vs_fe
                    }
                }
            }
            else_if = {
                # We are militarists
                limit = {
                    OR = {
                        is_militarist = yes
                        is_authoritarian = yes
                        is_xenophobe = yes
                    }
                }
                # They not apologized
                if = {
                    limit = {
                        has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
                    }
                    if = {
                        limit = {
                            NOT = {
                                has_casus_belli = {
                                    target = event_target:espionage_origin_country
                                    type = cb_hunger
                                }
                            }
                        }
                        add_casus_belli = {
                            type = cb_hunger
                            who = event_target:espionage_origin_country
                            days = 600
                        }
                    }
                    add_threat = {
                        who = event_target:espionage_origin_country
                        amount = 100
                    }
                    add_opinion_modifier = {
                        who = event_target:espionage_origin_country
                        modifier = opinion_discarded
                    }
                    # They are weaker than us
                    # They are not at war with us, but we can
                    if = {
                        limit = {
                            relative_power = {
                                who = event_target:espionage_origin_country
                                category = fleet
                                value >= equivalent
                            }
                            is_possible_declare_espionage_war = yes
                        }
                        random_list = {
                            30 = {
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_absorption
                                }
                            }
                            20 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_absorption
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            30 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            20 = {}
                        }
                    }
                    else_if = {
                        # They are stronger than us
                        # They are not at war with us, but we can
                        limit = {
                            relative_power = {
                                who = event_target:espionage_origin_country
                                category = fleet
                                value < equivalent
                            }
                            is_possible_declare_espionage_war = yes
                        }
                        random_list = {
                            10 = {
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_absorption
                                }
                            }
                            5 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_absorption
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            50 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            35 = {}
                        }
                    }
                    else = {
                        # They are at war with us
                        random_list = {
                            50 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            50 = {}
                        }
                    }
                }
                else = {
                    # They are apologized
                    if = {
                        limit = {
                            NOT = {
                                has_casus_belli = {
                                    target = event_target:espionage_origin_country
                                    type = cb_hunger
                                }
                            }
                        }
                        add_casus_belli = {
                            type = cb_hunger
                            who = event_target:espionage_origin_country
                            days = 300
                        }
                    }
                    add_threat = {
                        who = event_target:espionage_origin_country
                        amount = 50
                    }
                    add_opinion_modifier = {
                        who = event_target:espionage_origin_country
                        modifier = opinion_discarded
                    }
                    random_list = {
                        30 = {
                            modifier = {
                                factor = 0
                                NOT = {
                                    exists = event_target:espionage_origin_spy
                                }
                            }
                            modifier = {
                                factor = 0.9
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_1 = yes
                                }
                            }
                            modifier = {
                                factor = 0.8
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_2 = yes
                                }
                            }
                            modifier = {
                                factor = 0.7
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_3 = yes
                                }
                            }
                            modifier = {
                                factor = 0.6
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_4 = yes
                                }
                            }
                            modifier = {
                                factor = 0.5
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_5 = yes
                                }
                            }
                            event_target:espionage_origin_country = {
                                country_event = {
                                    id = aoe_espionage_actions.7
                                    days = 1
                                }
                            }
                        }
                        70 = {}
                    }
                }
            }
            else_if = {
                # We are pacifists
                limit = {
                    OR = {
                        is_pacifist = yes
                        is_xenophile = yes
                    }
                }
                # They not apologized
                if = {
                    limit = {
                        has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
                    }
                    if = {
                        limit = {
                            NOT = {
                                has_casus_belli = {
                                    target = event_target:espionage_origin_country
                                    type = cb_sublimation
                                }
                            }
                        }
                        add_casus_belli = {
                            type = cb_sublimation
                            who = event_target:espionage_origin_country
                            days = 300
                        }
                    }
                    add_threat = {
                        who = event_target:espionage_origin_country
                        amount = 100
                    }
                    add_opinion_modifier = {
                        who = event_target:espionage_origin_country
                        modifier = opinion_discarded
                    }
                    # They are weaker than us
                    # They are not at war with us, but we can
                    if = {
                        limit = {
                            relative_power = {
                                who = event_target:espionage_origin_country
                                category = fleet
                                value >= equivalent
                            }
                            is_possible_declare_espionage_war = yes
                        }
                        random_list = {
                            10 = {
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_assimilation
                                }
                            }
                            10 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_assimilation
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            30 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            50 = {}
                        }
                    }
                    else_if = {
                        # They are stronger than us
                        # They are not at war with us, but we can
                        limit = {
                            relative_power = {
                                who = event_target:espionage_origin_country
                                category = fleet
                                value < equivalent
                            }
                            is_possible_declare_espionage_war = yes
                        }
                        random_list = {
                            5 = {
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_assimilation
                                }
                            }
                            5 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_assimilation
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            30 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            60 = {}
                        }
                    }
                    else = {
                        # They are at war with us
                        random_list = {
                            30 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            70 = {}
                        }
                    }
                }
                else = {
                    # They are apologized
                    if = {
                        limit = {
                            NOT = {
                                has_casus_belli = {
                                    target = event_target:espionage_origin_country
                                    type = cb_sublimation
                                }
                            }
                        }
                        add_casus_belli = {
                            type = cb_sublimation
                            who = event_target:espionage_origin_country
                            days = 300
                        }
                    }
                    add_threat = {
                        who = event_target:espionage_origin_country
                        amount = 50
                    }
                    add_opinion_modifier = {
                        who = event_target:espionage_origin_country
                        modifier = opinion_discarded
                    }
                    random_list = {
                        20 = {
                            modifier = {
                                factor = 0
                                NOT = {
                                    exists = event_target:espionage_origin_spy
                                }
                            }
                            modifier = {
                                factor = 0.9
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_1 = yes
                                }
                            }
                            modifier = {
                                factor = 0.8
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_2 = yes
                                }
                            }
                            modifier = {
                                factor = 0.7
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_3 = yes
                                }
                            }
                            modifier = {
                                factor = 0.6
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_4 = yes
                                }
                            }
                            modifier = {
                                factor = 0.5
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_5 = yes
                                }
                            }
                            event_target:espionage_origin_country = {
                                country_event = {
                                    id = aoe_espionage_actions.7
                                    days = 1
                                }
                            }
                        }
                        80 = {}
                    }
                }
            }
            else = {
                # They not apologized
                if = {
                    limit = {
                        has_country_flag = espionage_charges_denied@event_target:espionage_origin_country
                    }
                    if = {
                        limit = {
                            NOT = {
                                has_casus_belli = {
                                    target = event_target:espionage_origin_country
                                    type = cb_subjugation
                                }
                            }
                        }
                        add_casus_belli = {
                            type = cb_subjugation
                            who = event_target:espionage_origin_country
                            days = 300
                        }
                    }
                    add_threat = {
                        who = event_target:espionage_origin_country
                        amount = 100
                    }
                    add_opinion_modifier = {
                        who = event_target:espionage_origin_country
                        modifier = opinion_discarded
                    }
                    # They are weaker than us
                    # They are not at war with us, but we can
                    if = {
                        limit = {
                            relative_power = {
                                who = event_target:espionage_origin_country
                                category = fleet
                                value >= equivalent
                            }
                            is_possible_declare_espionage_war = yes
                        }
                        random_list = {
                            10 = {
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_subjugation
                                }
                            }
                            10 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_subjugation
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            50 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            30 = {}
                        }
                    }
                    else_if = {
                        # They are stronger than us
                        # They are not at war with us, but we can
                        limit = {
                            relative_power = {
                                who = event_target:espionage_origin_country
                                category = fleet
                                value < equivalent
                            }
                            is_possible_declare_espionage_war = yes
                        }
                        random_list = {
                            8 = {
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_subjugation
                                }
                            }
                            7 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                declare_war = {
                                    target = event_target:espionage_origin_country
                                    name = "NAME_Holy_World_War"
                                    attacker_war_goal = wg_subjugation
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            50 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            35 = {}
                        }
                    }
                    else = {
                        # They are at war with us
                        random_list = {
                            50 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        exists = event_target:espionage_origin_spy
                                    }
                                }
                                modifier = {
                                    factor = 0.9
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_1 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.8
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_2 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.7
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_3 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.6
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_4 = yes
                                    }
                                }
                                modifier = {
                                    factor = 0.5
                                    exists = event_target:espionage_origin_spy
                                    event_target:espionage_origin_spy = {
                                        is_intelligencer_has_rank_5 = yes
                                    }
                                }
                                event_target:espionage_origin_country = {
                                    country_event = {
                                        id = aoe_espionage_actions.7
                                        days = 1
                                    }
                                }
                            }
                            50 = {}
                        }
                    }
                }
                else = {
                    # They apologized
                    if = {
                        limit = {
                            NOT = {
                                has_casus_belli = {
                                    target = event_target:espionage_origin_country
                                    type = cb_subjugation
                                }
                            }
                        }
                        add_casus_belli = {
                            type = cb_subjugation
                            who = event_target:espionage_origin_country
                            days = 500
                        }
                    }
                    add_threat = {
                        who = event_target:espionage_origin_country
                        amount = 50
                    }
                    add_opinion_modifier = {
                        who = event_target:espionage_origin_country
                        modifier = opinion_discarded
                    }
                    random_list = {
                        50 = {
                            modifier = {
                                factor = 0
                                NOT = {
                                    exists = event_target:espionage_origin_spy
                                }
                            }
                            modifier = {
                                factor = 0.9
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_1 = yes
                                }
                            }
                            modifier = {
                                factor = 0.8
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_2 = yes
                                }
                            }
                            modifier = {
                                factor = 0.7
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_3 = yes
                                }
                            }
                            modifier = {
                                factor = 0.6
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_4 = yes
                                }
                            }
                            modifier = {
                                factor = 0.5
                                exists = event_target:espionage_origin_spy
                                event_target:espionage_origin_spy = {
                                    is_intelligencer_has_rank_5 = yes
                                }
                            }
                            event_target:espionage_origin_country = {
                                country_event = {
                                    id = aoe_espionage_actions.7
                                    days = 1
                                }
                            }
                        }
                        50 = {}
                    }
                }
            }
        }
    }
}

country_event = {
    id = aoe_espionage_actions.6
    title = aoe_espionage_actions.6.title
    show_sound = event_conversation
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = {
        portrait = event_target:espionage_target_country
        planet_background = event_target:espionage_target_country
        graphical_culture = event_target:espionage_target_country
        city_level = event_target:espionage_target_country
        room = event_target:espionage_target_country.ruler
    }

    trigger = {
        exists = event_target:espionage_target_country
    }

    # They are fallen empire
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_country_type = fallen_empire
                    is_country_type = awakened_fallen_empire
                }
            }
        }
        text = aoe_espionage_actions.6.desc_01
    }

    # They are militarists
    # They are friendly to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_militarist = yes
                    is_authoritarian = yes
                    is_xenophobe = yes
                }
                OR = {
                    is_friendly_to = root
                    is_cordial_to = root
                    is_protective_to = root
                    is_loyal_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_02
    }

    # They are militarists
    # They are hostile to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_militarist = yes
                    is_authoritarian = yes
                    is_xenophobe = yes
                }
                OR = {
                    is_domineering_to = root
                    is_unfriendly_to = root
                    is_threatened_to = root
                    is_hostile_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_03
    }

    # They are militarists
    # They are neutral to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_militarist = yes
                    is_authoritarian = yes
                    is_xenophobe = yes
                }
                NOR = {
                    is_friendly_to = root
                    is_cordial_to = root
                    is_protective_to = root
                    is_loyal_to = root
                    is_domineering_to = root
                    is_unfriendly_to = root
                    is_threatened_to = root
                    is_hostile_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_04
    }

    # They are pacifists
    # They are friendly to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_pacifist = yes
                    is_xenophile = yes
                }
                OR = {
                    is_friendly_to = root
                    is_cordial_to = root
                    is_protective_to = root
                    is_loyal_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_05
    }

    # They are pacifists
    # They are hostile to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_pacifist = yes
                    is_xenophile = yes
                }
                OR = {
                    is_domineering_to = root
                    is_unfriendly_to = root
                    is_threatened_to = root
                    is_hostile_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_06
    }

    # They are pacifists
    # They are neutral to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                OR = {
                    is_pacifist = yes
                    is_xenophile = yes
                }
                NOR = {
                    is_friendly_to = root
                    is_cordial_to = root
                    is_protective_to = root
                    is_loyal_to = root
                    is_domineering_to = root
                    is_unfriendly_to = root
                    is_threatened_to = root
                    is_hostile_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_07
    }

    # They are not pacifists and not militarists
    # They are friendly to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                NOR = {
                    is_militarist = yes
                    is_authoritarian = yes
                    is_xenophobe = yes
                    is_pacifist = yes
                    is_xenophile = yes
                }
                OR = {
                    is_friendly_to = root
                    is_cordial_to = root
                    is_protective_to = root
                    is_loyal_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_08
    }

    # They are not pacifists and not militarists
    # They are hostile to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                NOR = {
                    is_militarist = yes
                    is_authoritarian = yes
                    is_xenophobe = yes
                    is_pacifist = yes
                    is_xenophile = yes
                }
                OR = {
                    is_domineering_to = root
                    is_unfriendly_to = root
                    is_threatened_to = root
                    is_hostile_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_09
    }

    # They are not pacifists and not militarists
    # They are neutral to us
    desc = {
        trigger = {
            event_target:espionage_target_country = {
                NOR = {
                    is_militarist = yes
                    is_authoritarian = yes
                    is_xenophobe = yes
                    is_pacifist = yes
                    is_xenophile = yes
                }
                NOR = {
                    is_friendly_to = root
                    is_cordial_to = root
                    is_protective_to = root
                    is_loyal_to = root
                    is_domineering_to = root
                    is_unfriendly_to = root
                    is_threatened_to = root
                    is_hostile_to = root
                }
            }
        }
        text = aoe_espionage_actions.6.desc_10
    }

    option = {
        name = "aoe_espionage_actions.6.a"
        custom_tooltip = "aoe_espionage_actions.6.a.tooltip"
        trigger = {
            is_militarist = yes
        }
        add_resource = {
            unity = 200
        }
        hidden_effect = {
            event_target:espionage_target_country = {
                set_timed_country_flag = {
                    flag = espionage_charges_denied@root
                    days = 2
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.b"
        custom_tooltip = "aoe_espionage_actions.6.b.tooltip"
        trigger = {
            is_authoritarian = yes
        }
        add_resource = {
            influence = 200
        }
        hidden_effect = {
            event_target:espionage_target_country = {
                set_timed_country_flag = {
                    flag = espionage_charges_denied@root
                    days = 2
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.c"
        custom_tooltip = "aoe_espionage_actions.6.c.tooltip"
        trigger = {
            is_xenophobe = yes
        }
        add_resource = {
            consumer_goods = 250
        }
        hidden_effect = {
            event_target:espionage_target_country = {
                set_timed_country_flag = {
                    flag = espionage_charges_denied@root
                    days = 2
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.d"
        custom_tooltip = "aoe_espionage_actions.6.d.tooltip"
        trigger = {
            NOR = {
                is_militarist = yes
                is_authoritarian = yes
                is_xenophobe = yes
            }
        }
        hidden_effect = {
            event_target:espionage_target_country = {
                set_timed_country_flag = {
                    flag = espionage_charges_denied@root
                    days = 2
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.e"
        custom_tooltip = "aoe_espionage_actions.6.e.tooltip"
        trigger = {
            OR = {
                is_pacifist = yes
                is_xenophile = yes
            }
            has_country_resource = {
                type = minerals
                amount > 500
            }
        }
        add_resource = {
            minerals = -500
        }
        hidden_effect = {
            event_target:espionage_target_country = {
                add_resource = {
                    minerals = 1000
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.f"
        custom_tooltip = "aoe_espionage_actions.6.f.tooltip"
        trigger = {
            OR = {
                is_pacifist = yes
                is_xenophile = yes
            }
        }
        hidden_effect = {
            random_list = {
                50 = {
                    modifier = {
                        factor = 0.5
                        event_target:espionage_target_country = {
                            is_xenophile = yes
                        }
                    }
                    modifier = {
                        factor = 10
                        event_target:espionage_target_country = {
                            is_fallen_empire = yes
                        }
                    }
                    event_target:espionage_target_country = {
                        set_timed_country_flag = {
                            flag = espionage_charges_denied@root
                            days = 2
                        }
                    }
                }
                50 = {}
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.g"
        custom_tooltip = "aoe_espionage_actions.6.g.tooltip"
        trigger = {
            NOR = {
                is_pacifist = yes
                is_xenophile = yes
            }
            has_country_resource = {
                type = minerals
                amount > 1000
            }
        }
        add_resource = {
            minerals = -1000
        }
        hidden_effect = {
            event_target:espionage_target_country = {
                add_resource = {
                    minerals = 1000
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.6.h"
        custom_tooltip = "aoe_espionage_actions.6.h.tooltip"
        trigger = {
            NOR = {
                is_pacifist = yes
                is_xenophile = yes
            }
        }
        hidden_effect = {
            random_list = {
                70 = {
                    event_target:espionage_target_country = {
                        set_timed_country_flag = {
                            flag = espionage_charges_denied@root
                            days = 2
                        }
                    }
                }
                30 = {}
            }
        }
    }

    after = {
        event_target:espionage_target_country = {
            country_event = {
                id = aoe_espionage_actions.5
                days = 1
            }
        }
    }
}

country_event = {
    id = aoe_espionage_actions.7
    title = aoe_espionage_actions.7.title
    desc = aoe_espionage_actions.7.desc
    picture = GFX_aoe_espionage_kill_spy
    show_sound = event_conversation
    is_triggered_only = yes
    hide_window = no
    location = event_target:espionage_origin_planet

    trigger = {
        exists = event_target:espionage_origin_planet
        exists = event_target:espionage_origin_spy
    }

    immediate = {
        event_target:espionage_origin_spy = {
            kill_pop = yes
        }
        event_target:espionage_origin_planet = {
            if = {
                limit = {
                    check_variable = {
                        which = "spies_was_killed_counter"
                        value < 1
                    }
                }
                set_variable = {
                    which = "spies_was_killed_counter"
                    value = 1
                }
            }
            else = {
                change_variable = {
                    which = "spies_was_killed_counter"
                    value = 1
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.7.a"
        custom_tooltip = "aoe_espionage_actions.7.a.tooltip"
        event_target:espionage_origin_planet = {
            every_pop = {
                limit = {
                    is_intelligencer = yes
                }
                add_modifier = {
                    modifier = "pop_recently_conquered"
                    days = 300
                }
            }
        }
    }

    option = {
        name = "aoe_espionage_actions.7.b"
        custom_tooltip = "aoe_espionage_actions.7.b.tooltip"
        trigger = {
            event_target:espionage_origin_planet = {
                check_variable = {
                    which = "spies_was_killed_counter"
                    value > 4
                }
                NOT = {
                    has_building = "building_spy_memorial"
                }
                free_building_slots > 0
            }
            has_country_resource = {
                type = minerals
                amount > 500
            }
        }
        add_resource = {
            minerals = -500
        }
        event_target:espionage_origin_planet = {
            add_building = "building_spy_memorial"
        }
    }
}

country_event = {
    id = aoe_espionage_actions.11
    title = aoe_espionage_actions.11.title
    picture = GFX_aoe_espionage_promote_spy
    show_sound = event_conversation
    is_triggered_only = yes
    hide_window = no
    location = event_target:espionage_origin_planet

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_not_ranked = yes
            }
        }
        text = aoe_espionage_actions.11.desc_01
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_1 = yes
            }
        }
        text = aoe_espionage_actions.11.desc_02
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_2 = yes
            }
        }
        text = aoe_espionage_actions.11.desc_03
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_3 = yes
            }
        }
        text = aoe_espionage_actions.11.desc_04
    }

    desc = {
        trigger = {
            event_target:espionage_origin_spy = {
                is_intelligencer_has_rank_4 = yes
            }
        }
        text = aoe_espionage_actions.11.desc_05
    }

    trigger = {
        exists = event_target:espionage_origin_planet
        exists = event_target:espionage_origin_spy
        event_target:espionage_origin_spy = {
            is_intelligencer_top_ranked = no
        }
    }

    immediate = {
        event_target:espionage_origin_spy = {
            if = {
                limit = {
                    NOR = {
                        pop_has_trait = "trait_intelligencer_neophyte"
                        pop_has_trait = "trait_intelligencer_acolyte"
                        pop_has_trait = "trait_intelligencer_adept"
                        pop_has_trait = "trait_intelligencer_master"
                        pop_has_trait = "trait_intelligencer_prophet"
                    }
                }
                modify_species = {
                    species = this
                    add_trait = "trait_intelligencer_neophyte"
                }
            }
            else_if = {
                limit = {
                    pop_has_trait = "trait_intelligencer_neophyte"
                    NOR = {
                        pop_has_trait = "trait_intelligencer_acolyte"
                        pop_has_trait = "trait_intelligencer_adept"
                        pop_has_trait = "trait_intelligencer_master"
                        pop_has_trait = "trait_intelligencer_prophet"
                    }
                }
                modify_species = {
                    species = this
                    remove_trait = "trait_intelligencer_neophyte"
                    add_trait = "trait_intelligencer_acolyte"
                }
            }
            else_if = {
                limit = {
                    pop_has_trait = "trait_intelligencer_acolyte"
                    NOR = {
                        pop_has_trait = "trait_intelligencer_adept"
                        pop_has_trait = "trait_intelligencer_master"
                        pop_has_trait = "trait_intelligencer_prophet"
                    }
                }
                modify_species = {
                    species = this
                    remove_trait = "trait_intelligencer_acolyte"
                    add_trait = "trait_intelligencer_adept"
                }
            }
            else_if = {
                limit = {
                    pop_has_trait = "trait_intelligencer_adept"
                    NOR = {
                        pop_has_trait = "trait_intelligencer_master"
                        pop_has_trait = "trait_intelligencer_prophet"
                    }
                }
                modify_species = {
                    species = this
                    remove_trait = "trait_intelligencer_adept"
                    add_trait = "trait_intelligencer_master"
                }
            }
            else_if = {
                limit = {
                    pop_has_trait = "trait_intelligencer_master"
                    NOT = {
                        pop_has_trait = "trait_intelligencer_prophet"
                    }
                }
                modify_species = {
                    species = this
                    remove_trait = "trait_intelligencer_master"
                    add_trait = "trait_intelligencer_prophet"
                }
            }
        }
    }

    option = {
        name = OK
    }
}

planet_event = {
    id = aoe_espionage_actions.12
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        any_pop = {
            is_intelligencer = yes
        }
        NOR = {
            has_modifier = "planet_intelligencer_training"
            has_modifier = "planet_intelligencer_disclosing"
        }
    }

    immediate = {
        every_pop = {
            limit = {
                is_intelligencer = yes
            }
            save_event_target_as = "espionage_origin_spy"

            disengage_intelligencer = yes
            revoke_intelligencer_from_assignment = yes
            engage_intelligencer_espionage_purpose_disclose_spies = yes

            if = {
                limit = {
                    root = {
                        has_building = "building_intelligence_agency_2"
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 500
                }
            }
            else_if = {
                limit = {
                    root = {
                        has_building = "building_intelligence_agency_3"
                    }
                }
                set_intelligencer_on_assignment = {
                    ARG1 = 700
                }
            }
            else = {
                set_intelligencer_on_assignment = {
                    ARG1 = 300
                }
            }
        }

        if = {
            limit = {
                has_building = "building_intelligence_agency_2"
            }
            add_modifier = {
                modifier = "planet_intelligencer_disclosing"
                days = 500
            }
        }
        else_if = {
            limit = {
                has_building = "building_intelligence_agency_3"
            }
            add_modifier = {
                modifier = "planet_intelligencer_disclosing"
                days = 700
            }
        }
        else = {
            add_modifier = {
                modifier = "planet_intelligencer_disclosing"
                days = 300
            }
        }
    }
}