namespace = aoe_pirate_actions

# Pirate country: appearance
country_event = {
    id = aoe_pirate_actions.1
    title = aoe_pirate_actions.1.title
    desc = aoe_pirate_actions.1.desc
    picture = GFX_aoe_pirate_emergence
    show_sound = event_yellow_alert

    mean_time_to_happen = {
        years = 5
        modifier = {
            factor = 0.95
            num_starbases > 4
        }
        modifier = {
            factor = 0.9
            num_starbases > 9
        }
        modifier = {
            factor = 0.85
            num_starbases > 14
        }
        modifier = {
            factor = 0.8
            num_starbases > 19
        }
        modifier = {
            factor = 0.75
            num_starbases > 24
        }
        modifier = {
            factor = 0.7
            num_starbases > 29
        }
    }

    trigger = {
        # is_regular_empire = yes
        is_ai = no
        count_country = {
            count < 10
            limit = {
                is_country_type = "rebellion_pirate"
            }
        }
        NOT = {
            any_country = {
                is_country_type = "rebellion_pirate"
                has_country_flag = rebellion_pirate_country@root
            }
        }
        any_system_within_border = {
            is_bordering_system = yes
        }
    }

    immediate = {
        random_system_within_border = {
            limit = {
                is_bordering_system = yes
            }
            random_system = {
                limit = {
                    distance = {
                        source = prev
                        min_distance >= 70
                        max_distance <= 300
                    }
                    is_desolated_system = yes
                    NOT = {
                        any_neighbor_system = {
                            is_desolated_system = no
                        }
                    }
                }
                random_system_planet = {
                    create_ambient_object = {
                        type = "caravaneer_billboard_1"
                        scale = 4
                        location = this
                        entity_offset_height = { min = -9 max = -11 }
                    }
                    last_created_ambient_object = {
                        set_ambient_object_flag = "rebellion_pirate_ambient_object"
                    }
                    create_country = {
                        name = "NAME_Pirates"
                        type = "rebellion_pirate"
                        species = root.owner_species
                        name_list = "PRT1"
                        flag = {
                            background = {
                                category = "backgrounds"
                                file = "00_solid.dds"
                            }
                            colors ={
                                "black"
                                "black"
                                "null"
                                "null"
                            }
                        }
                        effect = {
                            set_country_flag = rebellion_pirate_country@root
                            if = {
                                limit = {
                                    root = {
                                        is_fallen_empire = yes
                                    }
                                }
                                set_country_flag = "fe_pirate"
                            }
                            else_if = {
                                limit = {
                                    root = {
                                        is_robot_empire = yes
                                    }
                                }
                                set_country_flag = "robot_pirate"
                            }
                            else_if = {
                                limit = {
                                    root = {
                                        is_lithoid_empire = yes
                                    }
                                }
                                set_country_flag = "lithoid_pirate"
                            }
                        }
                    }
                    last_created_country = {
                        randomize_flag_symbol = "pirate"
                        random_list = {
                            5 = {
                                modifier = {
                                    factor = 0
                                    root = {
                                        OR = {
                                            is_lithoid_empire = yes
                                            is_fallen_empire = yes
                                            is_robot_empire = yes
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_fleet_size_small"
                                set_country_flag = "rebellion_pirate_leader_madness_light"
                            }
                            10 = {
                                modifier = {
                                    factor = 0
                                    root = {
                                        OR = {
                                            is_lithoid_empire = yes
                                            is_fallen_empire = yes
                                            is_robot_empire = yes
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_fleet_size_small"
                                set_country_flag = "rebellion_pirate_leader_madness_medium"
                            }
                            15 = {
                                modifier = {
                                    factor = 0
                                    root = {
                                        OR = {
                                            is_lithoid_empire = yes
                                            is_fallen_empire = yes
                                            is_robot_empire = yes
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_fleet_size_small"
                                set_country_flag = "rebellion_pirate_leader_madness_heavy"
                            }
                            10 = {
                                set_country_flag = "rebellion_pirate_fleet_size_normal"
                                set_country_flag = "rebellion_pirate_leader_madness_light"
                            }
                            15 = {
                                set_country_flag = "rebellion_pirate_fleet_size_normal"
                                set_country_flag = "rebellion_pirate_leader_madness_medium"
                            }
                            20 = {
                                set_country_flag = "rebellion_pirate_fleet_size_normal"
                                set_country_flag = "rebellion_pirate_leader_madness_heavy"
                            }
                            15 = {
                                modifier = {
                                    factor = 3
                                    root = {
                                        OR = {
                                            is_lithoid_empire = yes
                                            is_fallen_empire = yes
                                            is_robot_empire = yes
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_fleet_size_large"
                                set_country_flag = "rebellion_pirate_leader_madness_light"
                            }
                            20 = {
                                modifier = {
                                    factor = 3
                                    root = {
                                        OR = {
                                            is_lithoid_empire = yes
                                            is_fallen_empire = yes
                                            is_robot_empire = yes
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_fleet_size_large"
                                set_country_flag = "rebellion_pirate_leader_madness_medium"
                            }
                            25 = {
                                modifier = {
                                    factor = 3
                                    root = {
                                        OR = {
                                            is_lithoid_empire = yes
                                            is_fallen_empire = yes
                                            is_robot_empire = yes
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_fleet_size_large"
                                set_country_flag = "rebellion_pirate_leader_madness_heavy"
                            }
                        }
                    }
                }
                # Create starbase
                if = {
                    limit = {
                        has_global_flag = "has_nsc_active"
                        root = {
                            is_fallen_empire = yes
                        }
                    }
                    create_starbase = {
                        owner = last_created_country
                        size = "starbase_headquarters"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        building = "defense_grid"
                        building = "disruption_field"
                        building = "warp_fluctuator"

                        effect = {
                            while = {
                                count = 12
                                create_ship = {
                                    name = random
                                    design = "NAME_Devastator"
                                    graphical_culture = owner
                                }
                            }
                        }
                    }
                }
                else_if = {
                    limit = {
                        has_global_flag = "has_nsc_active"
                        root = {
                            is_robot_empire = yes
                        }
                    }
                    create_starbase = {
                        owner = last_created_country
                        size = "starbase_stronghold"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        building = "defense_grid"
                        building = "target_uplink_computer"

                        effect = {
                            while = {
                                count = 9
                                create_ship = {
                                    name = random
                                    design = "NAME_Sigma"
                                    graphical_culture = owner
                                }
                            }
                        }
                    }
                }
                else_if = {
                    limit = {
                        root = {
                            is_lithoid_empire = yes
                        }
                    }
                    create_starbase = {
                        owner = last_created_country
                        size = "starbase_citadel"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "gun_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        module = "missile_battery"
                        building = "defense_grid"

                        effect = {
                            while = {
                                count = 7
                                create_ship = {
                                    name = random
                                    design = "NAME_AI_1"
                                    graphical_culture = owner
                                }
                            }
                        }
                    }
                }
                else = {
                    random_list = {
                        40 = {
                            create_starbase = {
                                size = "starbase_citadel"
                                owner = last_created_country
                                module = "gun_battery"
                                module = "gun_battery"
                                module = "gun_battery"
                                module = "missile_battery"
                                module = "missile_battery"

                                effect = {
                                    while = {
                                        count = 6
                                        create_ship = {
                                            name = random
                                            design = "NAME_AI_2"
                                            graphical_culture = owner
                                        }
                                    }
                                }
                            }
                        }
                        20 = {
                            create_starbase = {
                                size = "starbase_starfortress"
                                owner = last_created_country
                                module = "gun_battery"
                                module = "gun_battery"
                                module = "missile_battery"
                                module = "missile_battery"

                                effect = {
                                    while = {
                                        count = 5
                                        create_ship = {
                                            name = random
                                            design = "NAME_AI_2"
                                            graphical_culture = owner
                                        }
                                    }
                                }
                            }
                        }
                        10 = {
                            create_starbase = {
                                size = "starbase_starhold"
                                owner = last_created_country
                                module = "gun_battery"
                                module = "gun_battery"
                                module = "missile_battery"

                                effect = {
                                    while = {
                                        count = 4
                                        create_ship = {
                                            name = random
                                            design = "NAME_AI_2"
                                            graphical_culture = owner
                                        }
                                    }
                                }
                            }
                        }
                        5 = {
                            create_starbase = {
                                size = "starbase_starport"
                                owner = last_created_country
                                module = "gun_battery"
                                module = "gun_battery"

                                effect = {
                                    while = {
                                        count = 3
                                        create_ship = {
                                            name = random
                                            design = "NAME_AI_2"
                                            graphical_culture = owner
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                # Create ambient objects
                every_system_planet = {
                    limit = {
                        is_star = no
                        is_asteroid = no
                    }
                    while = {
                        count = 10
                        random_list = {
                            25 = {
                                solar_system = {
                                    create_ambient_object = {
                                        type = "small_debris_object"
                                        entity_offset_height = { min = -0 max = -25 }
                                    }
                                }
                            }
                            25 = {
                                solar_system = {
                                    create_ambient_object = {
                                        type = "medium_debris_01_object"
                                        entity_offset_height = { min = -0 max = -25 }
                                    }
                                }
                            }
                            25 = {
                                solar_system = {
                                    create_ambient_object = {
                                        type = "medium_debris_02_object"
                                        entity_offset_height = { min = -0 max = -25 }
                                    }
                                }
                            }
                            25 = {
                                solar_system = {
                                    create_ambient_object = {
                                        type = "large_debris_object"
                                        entity_offset_height = { min = -0 max = -25 }
                                    }
                                }
                            }
                        }
                        last_created_ambient_object = {
                            set_location = {
                                target = prev
                                distance = 50
                                angle = random
                            }
                            set_ambient_object_flag = "rebellion_pirate_ambient_object"
                        }
                    }
                }
                log = ">>> aoe_pirate_actions.1: pirate country for [Root.GetName] created at the [This.GetName] system"
            }
        }
        # Update hostility
        every_country = {
            limit = {
                OR = {
                    is_country_type = "pirate"
                    is_country_type = "dormant_marauders"
                    is_country_type = "awakened_marauders"
                    is_country_type = "ruined_marauders"
                    is_country_type = "marauder_raiders"
                    is_country_type = "rebellion_pirate"
                }
                NOT = {
                    is_same_value = last_created_country
                }
            }
            establish_communications_no_message = last_created_country
            set_faction_hostility = {
                target = last_created_country
                set_hostile = no
                set_neutral = no
                set_friendly = yes
            }
            last_created_country = {
                set_faction_hostility = {
                    target = prev
                    set_hostile = no
                    set_neutral = no
                    set_friendly = yes
                }
            }
        }
        # Update communications
        last_created_country = {
            every_neighbor_country = {
                limit = {
                    is_regular_empire = yes
                    NOT = {
                        has_communications = prev
                    }
                }
                establish_communications_no_message = prev
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.1.a"
        custom_tooltip = "aoe_pirate_actions.1.a.tooltip"
    }
}

# Pirate country: patrol fleet appearance
country_event = {
    id = aoe_pirate_actions.2
    hide_window = yes

    mean_time_to_happen = {
        months = 24
        modifier = {
            factor = 0.8
            any_owned_starbase = {
                has_starbase_size = starbase_starhold
            }
        }
        modifier = {
            factor = 0.6
            any_owned_starbase = {
                has_starbase_size = starbase_starfortress
            }
        }
        modifier = {
            factor = 0.4
            any_owned_starbase = {
                has_starbase_size = starbase_citadel
            }
        }
        modifier = {
            factor = 0.2
            has_global_flag = "has_nsc_active"
            any_owned_starbase = {
                has_starbase_size = starbase_stronghold
            }
        }
        modifier = {
            factor = 0.1
            has_global_flag = "has_nsc_active"
            any_owned_starbase = {
                has_starbase_size = starbase_headquarters
            }
        }
    }

    trigger = {
        is_country_type = "rebellion_pirate"
    }

    immediate = {
        if = {
            limit = {
                has_country_flag = "rebellion_pirate_fleet_size_normal"
            }
            set_variable = {
                which = "rebellion_pirate_fleet_size_pool"
                value = 3
            }
        }
        else_if = {
            limit = {
                has_country_flag = "rebellion_pirate_fleet_size_large"
            }
            set_variable = {
                which = "rebellion_pirate_fleet_size_pool"
                value = 4
            }
        }
        else = {
            set_variable = {
                which = "rebellion_pirate_fleet_size_pool"
                value = 2
            }
        }
        log = ">>> aoe_pirate_actions.2: patrol fleet pool before = [Root.rebellion_pirate_fleet_size_pool]"
        every_owned_fleet = {
            limit = {
                has_fleet_flag = "rebellion_pirate_fleet_patrol"
            }
            if = {
                limit = {
                    root = {
                        check_variable = {
                            which = "rebellion_pirate_fleet_size_pool"
                            value > 0
                        }
                    }
                }
                root = {
                    subtract_variable = {
                        which = "rebellion_pirate_fleet_size_pool"
                        value = 1
                    }
                }
            }
        }
        log = ">>> aoe_pirate_actions.2: patrol fleet pool after = [Root.rebellion_pirate_fleet_size_pool]"
        if = {
            limit = {
                check_variable = {
                    which = "rebellion_pirate_fleet_size_pool"
                    value > 0
                }
            }
            create_leader = {
                class = admiral
                species = root.owner_species
                name = random
                skill = 1
                immortal = yes
                traits = {
                    trait = random_trait
                }
            }
            last_created_leader = {
                if = {
                    limit = {
                        root = {
                            has_country_flag = "fe_pirate"
                        }
                    }
                    add_skill = 9
                }
                else_if = {
                    limit = {
                        root = {
                            has_country_flag = "robot_pirate"
                        }
                    }
                    add_skill = 8
                }
                else_if = {
                    limit = {
                        root = {
                            has_country_flag = "lithoid_pirate"
                        }
                    }
                    add_skill = 7
                }
                else = {
                    random_list = {
                        1 = {
                            add_skill = 9
                        }
                        2 = {
                            add_skill = 8
                        }
                        5 = {
                            add_skill = 7
                        }
                        10 = {
                            add_skill = 6
                        }
                        25 = {
                            add_skill = 5
                        }
                        10 = {
                            add_skill = 4
                        }
                        5 = {
                            add_skill = 3
                        }
                        2 = {
                            add_skill = 2
                        }
                        1 = {
                            add_skill = 1
                        }
                    }
                }
            }
            create_fleet = {
                name = "NAME_Pirate_Patrol_Fleet"
                effect = {
                    set_owner = root
                    if = {
                        limit = {
                            root = {
                                has_country_flag = "fe_pirate"
                            }
                        }
                        random_list = {
                            100 = {
                                set_name = "NAME_Fallen_Empire_Pirate_Patrol_Fleet_10"
                                set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                create_pirate_ships_10 = yes
                            }
                            75 = {
                                set_name = "NAME_Fallen_Empire_Pirate_Patrol_Fleet_11"
                                set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                create_pirate_ships_11 = yes
                            }
                            50 = {
                                set_name = "NAME_Fallen_Empire_Pirate_Patrol_Fleet_12"
                                set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                create_pirate_ships_12 = yes
                            }
                            25 = {
                                set_name = "NAME_Fallen_Empire_Pirate_Patrol_Fleet_13"
                                set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                create_pirate_ships_13 = yes
                            }
                            10 = {
                                set_name = "NAME_Fallen_Empire_Pirate_Patrol_Fleet_14"
                                set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                create_pirate_ships_14 = yes
                            }
                            5 = {
                                set_name = "NAME_Fallen_Empire_Pirate_Patrol_Fleet_15"
                                set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                create_pirate_ships_15 = yes
                            }
                        }
                    }
                    else_if = {
                        limit = {
                            root = {
                                has_country_flag = "robot_pirate"
                            }
                        }
                        random_list = {
                            100 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_9"
                                set_fleet_flag = "rebellion_pirate_fleet_power_9"
                                create_pirate_ships_9 = yes
                            }
                            75 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_10"
                                set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                create_pirate_ships_10 = yes
                            }
                            50 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_11"
                                set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                create_pirate_ships_11 = yes
                            }
                            25 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_12"
                                set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                create_pirate_ships_12 = yes
                            }
                            10 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_13"
                                set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                create_pirate_ships_13 = yes
                            }
                            5 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_14"
                                set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                create_pirate_ships_14 = yes
                            }
                            1 = {
                                set_name = "NAME_Robot_Pirate_Patrol_Fleet_15"
                                set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                create_pirate_ships_15 = yes
                            }
                        }
                    }
                    else_if = {
                        limit = {
                            root = {
                                has_country_flag = "lithoid_pirate"
                            }
                        }
                        random_list = {
                            100 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_8"
                                set_fleet_flag = "rebellion_pirate_fleet_power_8"
                                create_pirate_ships_8 = yes
                            }
                            75 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_9"
                                set_fleet_flag = "rebellion_pirate_fleet_power_9"
                                create_pirate_ships_9 = yes
                            }
                            50 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_10"
                                set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                create_pirate_ships_10 = yes
                            }
                            25 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_11"
                                set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                create_pirate_ships_11 = yes
                            }
                            10 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_12"
                                set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                create_pirate_ships_12 = yes
                            }
                            5 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_13"
                                set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                create_pirate_ships_13 = yes
                            }
                            2 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_14"
                                set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                create_pirate_ships_14 = yes
                            }
                            1 = {
                                set_name = "NAME_Lithoid_Pirate_Patrol_Fleet_15"
                                set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                create_pirate_ships_15 = yes
                            }
                        }
                    }
                    else = {
                        random_list = {
                            1 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_citadel
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_15"
                                set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                create_pirate_ships_15 = yes
                            }
                            2 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_citadel
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_14"
                                set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                create_pirate_ships_14 = yes
                            }
                            4 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_citadel
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_13"
                                set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                create_pirate_ships_13 = yes
                            }
                            6 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_citadel
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_12"
                                set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                create_pirate_ships_12 = yes
                            }
                            8 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_citadel
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_11"
                                set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                create_pirate_ships_11 = yes
                            }
                            12 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starfortress
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_10"
                                set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                create_pirate_ships_10 = yes
                            }
                            16 = {
                                modifier = {
                                    factor = 2
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starfortress
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_9"
                                set_fleet_flag = "rebellion_pirate_fleet_power_9"
                                create_pirate_ships_9 = yes
                            }
                            20 = {
                                set_name = "NAME_Pirate_Patrol_Fleet_8"
                                set_fleet_flag = "rebellion_pirate_fleet_power_8"
                                create_pirate_ships_8 = yes
                            }
                            30 = {
                                modifier = {
                                    factor = 0.5
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starfortress
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_7"
                                set_fleet_flag = "rebellion_pirate_fleet_power_7"
                                create_pirate_ships_7 = yes
                            }
                            20 = {
                                modifier = {
                                    factor = 0.5
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starfortress
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_6"
                                set_fleet_flag = "rebellion_pirate_fleet_power_6"
                                create_pirate_ships_6 = yes
                            }
                            16 = {
                                modifier = {
                                    factor = 0.5
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starhold
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_5"
                                set_fleet_flag = "rebellion_pirate_fleet_power_5"
                                create_pirate_ships_5 = yes
                            }
                            12 = {
                                modifier = {
                                    factor = 0.5
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starhold
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_4"
                                set_fleet_flag = "rebellion_pirate_fleet_power_4"
                                create_pirate_ships_4 = yes
                            }
                            6 = {
                                modifier = {
                                    factor = 0
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starhold
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_3"
                                set_fleet_flag = "rebellion_pirate_fleet_power_3"
                                create_pirate_ships_3 = yes
                            }
                            4 = {
                                modifier = {
                                    factor = 0
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starhold
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_2"
                                set_fleet_flag = "rebellion_pirate_fleet_power_2"
                                create_pirate_ships_2 = yes
                            }
                            2 = {
                                modifier = {
                                    factor = 0
                                    root = {
                                        any_owned_starbase = {
                                            has_starbase_size >= starbase_starhold
                                        }
                                    }
                                }
                                set_name = "NAME_Pirate_Patrol_Fleet_1"
                                set_fleet_flag = "rebellion_pirate_fleet_power_1"
                                create_pirate_ships_1 = yes
                            }
                        }
                    }
                    assign_leader = last_created_leader
                    set_fleet_stance = aggressive
                    set_aggro_range_measure_from = self
                    set_aggro_range = 800
                    set_fleet_flag = "rebellion_pirate_fleet_patrol"
                    log = ">>> aoe_pirate_actions.2: pirate patrol fleet created"
                }
                settings = {
                    uses_naval_capacity = no
                }
            }
            random_owned_starbase = {
                fleet.solar_system.star = {
                    last_created_fleet = {
                        set_location = {
                            target = prev
                            distance = 10
                            angle = random
                        }
                        log = ">>> aoe_pirate_actions.2: pirate patrol fleet located at [Prev.solar_system.GetName] system"
                    }
                }
            }
            last_created_fleet = {
                fleet_event = {
                    id = aoe_pirate_actions.20
                    days = 30
                    random = 25
                }
            }
            set_variable = {
                which = "rebellion_pirate_fleet_size_pool"
                value = 0
            }
        }
    }
}

# Pirate country: target selection
country_event = {
    id = aoe_pirate_actions.5
    hide_window = yes

    mean_time_to_happen = {
        months = 60
        modifier = {
            factor = 0.75
            has_country_flag = "rebellion_pirate_leader_madness_medium"
        }
        modifier = {
            factor = 0.5
            has_country_flag = "rebellion_pirate_leader_madness_heavy"
        }
        modifier = {
            factor = 0.7
            count_country = {
                count >= 3
                limit = {
                    is_neighbor_of = root
                    NOR = {
                        is_country_type = "pirate"
                        is_country_type = "dormant_marauders"
                        is_country_type = "awakened_marauders"
                        is_country_type = "ruined_marauders"
                        is_country_type = "marauder_raiders"
                        is_country_type = "rebellion_pirate"
                    }
                }
            }
        }
        modifier = {
            factor = 0.8
            count_country = {
                count = 2
                limit = {
                    is_neighbor_of = root
                    NOR = {
                        is_country_type = "pirate"
                        is_country_type = "dormant_marauders"
                        is_country_type = "awakened_marauders"
                        is_country_type = "ruined_marauders"
                        is_country_type = "marauder_raiders"
                        is_country_type = "rebellion_pirate"
                    }
                }
            }
        }
        modifier = {
            factor = 0.9
            count_country = {
                count = 1
                limit = {
                    is_neighbor_of = root
                    NOR = {
                        is_country_type = "pirate"
                        is_country_type = "dormant_marauders"
                        is_country_type = "awakened_marauders"
                        is_country_type = "ruined_marauders"
                        is_country_type = "marauder_raiders"
                        is_country_type = "rebellion_pirate"
                    }
                }
            }
        }
    }

    trigger = {
        is_country_type = "rebellion_pirate"
    }

    immediate = {
        every_owned_starbase = {
            fleet.solar_system = {
                closest_system = {
                    limit = {
                        exists = space_owner
                        space_owner = {
                            is_regular_empire = yes
                        }
                        distance = {
                            source = prev
                            use_bypasses = no
                            min_jumps = 1
                            max_jumps = 5
                        }
                    }
                    save_event_target_as = rebellion_pirate_target_system
                    set_timed_star_flag = {
                        flag = rebellion_pirate_target_system@root
                        days = 600
                    }
                    root = {
                        save_event_target_as = rebellion_pirate_country
                    }
                    prev = {
                        save_event_target_as = rebellion_pirate_system
                    }
                    space_owner = {
                        save_event_target_as = rebellion_pirate_target_country
                        set_timed_country_flag = {
                            flag = rebellion_pirate_target_country@root
                            days = 600
                        }
                        if = {
                            limit = {
                                NOT = {
                                    has_communications = root
                                }
                            }
                            establish_communications_no_message = root
                        }
                        random_list = {
                            1 = {
                                modifier = {
                                    factor = 0
                                    OR = {
                                        is_lithoid_empire = yes
                                        is_robot_empire = yes
                                        root = {
                                            OR = {
                                                is_lithoid_empire = yes
                                                is_robot_empire = yes
                                            }
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_food_resources"
                                intelligence_gather_resource_data = {
                                    ARG1 = food
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    has_country_resource = {
                                        type = food
                                        amount < 1
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_minerals_resources"
                                intelligence_gather_resource_data = {
                                    ARG1 = minerals
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    has_country_resource = {
                                        type = energy
                                        amount < 1
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_energy_resources"
                                intelligence_gather_resource_data = {
                                    ARG1 = energy
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    has_country_resource = {
                                        type = alloys
                                        amount < 1
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_alloys_resources"
                                intelligence_gather_resource_data = {
                                    ARG1 = alloys
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    has_country_resource = {
                                        type = consumer_goods
                                        amount < 1
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_consumer_goods_resources"
                                intelligence_gather_resource_data = {
                                    ARG1 = consumer_goods
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_science_ship"
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_science_ships"
                                intelligence_gather_shipclass_data = {
                                    ARG1 = shipclass_science_ship
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_constructor"
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_construction_ships"
                                intelligence_gather_shipclass_data = {
                                    ARG1 = shipclass_constructor
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_transport"
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_transport_ships"
                                intelligence_gather_shipclass_data = {
                                    ARG1 = shipclass_transport
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    OR = {
                                        NOT = {
                                            any_owned_ship = {
                                                is_ship_class = "shipclass_military"
                                                is_ship_size = "corvette"
                                            }
                                        }
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_military"
                                            OR = {
                                                is_ship_size = "destroyer"
                                                is_ship_size = "cruiser"
                                                is_ship_size = "battleship"
                                                is_ship_size = "colossus"
                                            }
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_corvette_ships"
                                intelligence_gather_ship_data = {
                                    ARG1 = corvette
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    OR = {
                                        NOT = {
                                            any_owned_ship = {
                                                is_ship_class = "shipclass_military"
                                                is_ship_size = "destroyer"
                                            }
                                        }
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_military"
                                            OR = {
                                                is_ship_size = "cruiser"
                                                is_ship_size = "battleship"
                                                is_ship_size = "colossus"
                                            }
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_destroyer_ships"
                                intelligence_gather_ship_data = {
                                    ARG1 = destroyer
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    OR = {
                                        NOT = {
                                            any_owned_ship = {
                                                is_ship_class = "shipclass_military"
                                                is_ship_size = "cruiser"
                                            }
                                        }
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_military"
                                            OR = {
                                                is_ship_size = "battleship"
                                                is_ship_size = "colossus"
                                            }
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_cruiser_ships"
                                intelligence_gather_ship_data = {
                                    ARG1 = cruiser
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    OR = {
                                        NOT = {
                                            any_owned_ship = {
                                                is_ship_class = "shipclass_military"
                                                is_ship_size = "battleship"
                                            }
                                        }
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_military"
                                            is_ship_size = "colossus"
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_battleship_ships"
                                intelligence_gather_ship_data = {
                                    ARG1 = battleship
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_ship = {
                                            is_ship_class = "shipclass_military"
                                            is_ship_size = "colossus"
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_colossus_ships"
                                intelligence_gather_ship_data = {
                                    ARG1 = colossus
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_leader = {
                                            leader_class = scientist
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_scientist_leaders"
                                intelligence_gather_any_leader_data = {
                                    ARG1 = scientist
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_leader = {
                                            leader_class = admiral
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_admiral_leaders"
                                intelligence_gather_any_leader_data = {
                                    ARG1 = admiral
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_leader = {
                                            leader_class = general
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_general_leaders"
                                intelligence_gather_any_leader_data = {
                                    ARG1 = general
                                }
                            }
                            1 = {
                                modifier = {
                                    factor = 0
                                    NOT = {
                                        any_owned_leader = {
                                            leader_class = governor
                                        }
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_governor_leaders"
                                intelligence_gather_any_leader_data = {
                                    ARG1 = governor
                                }
                            }
                            10 = {
                                modifier = {
                                    factor = 0
                                    capital_scope = {
                                        is_same_value = prevprev
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_system"
                            }
                            10 = {
                                modifier = {
                                    factor = 0
                                    prev = {
                                        NOT = {
                                            any_system_planet = {
                                                is_colony = yes
                                                OR = {
                                                    is_owned_by = event_target:rebellion_pirate_target_country
                                                    is_controlled_by = event_target:rebellion_pirate_target_country
                                                }
                                                count_pops = {
                                                    limit = {
                                                        OR = {
                                                            is_unemployed = yes
                                                            is_enslaved = yes
                                                            is_being_purged = yes
                                                        }
                                                        happiness < 0.5
                                                    }
                                                    count > 0
                                                }
                                            }
                                        }
                                    }
                                }
                                prev = {
                                    random_system_planet = {
                                        limit = {
                                            is_colony = yes
                                            OR = {
                                                is_owned_by = event_target:rebellion_pirate_target_country
                                                is_controlled_by = event_target:rebellion_pirate_target_country
                                            }
                                            count_pops = {
                                                limit = {
                                                    OR = {
                                                        is_unemployed = yes
                                                        is_enslaved = yes
                                                        is_being_purged = yes
                                                    }
                                                    happiness < 0.5
                                                }
                                                count > 0
                                            }
                                        }
                                        set_variable = {
                                            which = espionage_data_unhappy_pops_count
                                            value = 0
                                        }
                                        every_owned_pop = {
                                            limit = {
                                                OR = {
                                                    is_unemployed = yes
                                                    is_enslaved = yes
                                                    is_being_purged = yes
                                                }
                                                happiness < 0.5
                                            }
                                            prev = {
                                                change_variable = {
                                                    which = espionage_data_unhappy_pops_count
                                                    value = 1
                                                }
                                            }
                                        }
                                        save_event_target_as = rebellion_pirate_target_planet
                                    }
                                }
                                set_country_flag = "rebellion_pirate_demands_pops"
                            }
                        }
                        country_event = {
                            id = aoe_pirate_actions.6
                        }
                        log = ">>> aoe_pirate_actions.2: pirate country located at [PrevPrev.GetName] system found victim [This.GetName]"
                    }
                    break = yes
                }
            }
        }
    }
}

# Pirate country: submission of claims
country_event = {
    id = aoe_pirate_actions.6
    title = aoe_pirate_actions.6.title
    show_sound = event_sensor_ping
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = {
        portrait = event_target:rebellion_pirate_country
        room = default_room
    }

    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_food_resources"
        }
        text = aoe_pirate_actions.6.desc_01
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_minerals_resources"
        }
        text = aoe_pirate_actions.6.desc_02
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_energy_resources"
        }
        text = aoe_pirate_actions.6.desc_03
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_alloys_resources"
        }
        text = aoe_pirate_actions.6.desc_04
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_consumer_goods_resources"
        }
        text = aoe_pirate_actions.6.desc_05
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_science_ships"
        }
        text = aoe_pirate_actions.6.desc_06
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_construction_ships"
        }
        text = aoe_pirate_actions.6.desc_07
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_transport_ships"
        }
        text = aoe_pirate_actions.6.desc_08
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_corvette_ships"
        }
        text = aoe_pirate_actions.6.desc_09
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_destroyer_ships"
        }
        text = aoe_pirate_actions.6.desc_10
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_cruiser_ships"
        }
        text = aoe_pirate_actions.6.desc_11
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_battleship_ships"
        }
        text = aoe_pirate_actions.6.desc_12
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_colossus_ships"
        }
        text = aoe_pirate_actions.6.desc_13
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_scientist_leaders"
        }
        text = aoe_pirate_actions.6.desc_20
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_admiral_leaders"
        }
        text = aoe_pirate_actions.6.desc_21
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_general_leaders"
        }
        text = aoe_pirate_actions.6.desc_22
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_governor_leaders"
        }
        text = aoe_pirate_actions.6.desc_23
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_system"
        }
        text = aoe_pirate_actions.6.desc_24
    }
    desc = {
        trigger = {
            has_country_flag = "rebellion_pirate_demands_pops"
        }
        text = aoe_pirate_actions.6.desc_25
    }
    desc = {
        trigger = {
            NOR = {
                has_country_flag = "rebellion_pirate_demands_food_resources"
                has_country_flag = "rebellion_pirate_demands_minerals_resources"
                has_country_flag = "rebellion_pirate_demands_energy_resources"
                has_country_flag = "rebellion_pirate_demands_alloys_resources"
                has_country_flag = "rebellion_pirate_demands_consumer_goods_resources"
                has_country_flag = "rebellion_pirate_demands_science_ships"
                has_country_flag = "rebellion_pirate_demands_construction_ships"
                has_country_flag = "rebellion_pirate_demands_transport_ships"
                has_country_flag = "rebellion_pirate_demands_corvette_ships"
                has_country_flag = "rebellion_pirate_demands_destroyer_ships"
                has_country_flag = "rebellion_pirate_demands_cruiser_ships"
                has_country_flag = "rebellion_pirate_demands_battleship_ships"
                has_country_flag = "rebellion_pirate_demands_colossus_ships"
                has_country_flag = "rebellion_pirate_demands_scientist_leaders"
                has_country_flag = "rebellion_pirate_demands_admiral_leaders"
                has_country_flag = "rebellion_pirate_demands_general_leaders"
                has_country_flag = "rebellion_pirate_demands_governor_leaders"
                has_country_flag = "rebellion_pirate_demands_system"
                has_country_flag = "rebellion_pirate_demands_pops"
            }
        }
        text = aoe_pirate_actions.6.desc_50
    }

    trigger = {
        exists = event_target:rebellion_pirate_country
    }

    after = {
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_food_resources" }
            remove_country_flag = "rebellion_pirate_demands_food_resources"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_minerals_resources" }
            remove_country_flag = "rebellion_pirate_demands_minerals_resources"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_energy_resources" }
            remove_country_flag = "rebellion_pirate_demands_energy_resources"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_alloys_resources" }
            remove_country_flag = "rebellion_pirate_demands_alloys_resources"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_consumer_goods_resources" }
            remove_country_flag = "rebellion_pirate_demands_consumer_goods_resources"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_science_ships" }
            remove_country_flag = "rebellion_pirate_demands_science_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_construction_ships" }
            remove_country_flag = "rebellion_pirate_demands_construction_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_transport_ships" }
            remove_country_flag = "rebellion_pirate_demands_transport_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_corvette_ships" }
            remove_country_flag = "rebellion_pirate_demands_corvette_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_destroyer_ships" }
            remove_country_flag = "rebellion_pirate_demands_destroyer_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_cruiser_ships" }
            remove_country_flag = "rebellion_pirate_demands_cruiser_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_battleship_ships" }
            remove_country_flag = "rebellion_pirate_demands_battleship_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_colossus_ships" }
            remove_country_flag = "rebellion_pirate_demands_colossus_ships"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_scientist_leaders" }
            remove_country_flag = "rebellion_pirate_demands_scientist_leaders"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_admiral_leaders" }
            remove_country_flag = "rebellion_pirate_demands_admiral_leaders"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_general_leaders" }
            remove_country_flag = "rebellion_pirate_demands_general_leaders"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_governor_leaders" }
            remove_country_flag = "rebellion_pirate_demands_governor_leaders"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_system" }
            remove_country_flag = "rebellion_pirate_demands_system"
        }
        if = {
            limit = { has_country_flag = "rebellion_pirate_demands_pops" }
            remove_country_flag = "rebellion_pirate_demands_pops"
        }
        if = {
            limit = {
                exists = event_target:rebellion_pirate_target_planet
                event_target:rebellion_pirate_target_planet = {
                    check_variable = {
                        which = espionage_data_unhappy_pops_count
                        value > 0
                    }
                }
            }
            event_target:rebellion_pirate_target_planet = {
                set_variable = {
                    which = espionage_data_unhappy_pops_count
                    value = 0
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.a"
        custom_tooltip = "aoe_pirate_actions.6.a.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_food_resources"
            has_country_resource = {
                type = food
                amount > 10
            }
        }
        hidden_effect = {
            withdraw_stockpile_resource = {
                ARG1 = food
                ARG2 = 10
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.b"
        custom_tooltip = "aoe_pirate_actions.6.b.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_minerals_resources"
            has_country_resource = {
                type = minerals
                amount > 10
            }
        }
        hidden_effect = {
            withdraw_stockpile_resource = {
                ARG1 = minerals
                ARG2 = 10
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.c"
        custom_tooltip = "aoe_pirate_actions.6.c.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_energy_resources"
            has_country_resource = {
                type = energy
                amount > 10
            }
        }
        hidden_effect = {
            withdraw_stockpile_resource = {
                ARG1 = energy
                ARG2 = 10
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.d"
        custom_tooltip = "aoe_pirate_actions.6.d.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_alloys_resources"
            has_country_resource = {
                type = alloys
                amount > 10
            }
        }
        hidden_effect = {
            withdraw_stockpile_resource = {
                ARG1 = alloys
                ARG2 = 10
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.e"
        custom_tooltip = "aoe_pirate_actions.6.e.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_consumer_goods_resources"
            has_country_resource = {
                type = consumer_goods
                amount > 10
            }
        }
        hidden_effect = {
            withdraw_stockpile_resource = {
                ARG1 = consumer_goods
                ARG2 = 10
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.f"
        custom_tooltip = "aoe_pirate_actions.6.f.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_science_ships"
            any_owned_ship = {
                is_ship_class = "shipclass_science_ship"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_science_ship"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.g"
        custom_tooltip = "aoe_pirate_actions.6.g.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_construction_ships"
            any_owned_ship = {
                is_ship_class = "shipclass_constructor"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_constructor"
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.h"
        custom_tooltip = "aoe_pirate_actions.6.h.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_transport_ships"
            any_owned_fleet = {
                is_ship_class = "shipclass_transport"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_transport"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.j"
        custom_tooltip = "aoe_pirate_actions.6.j.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_corvette_ships"
            any_owned_fleet = {
                is_ship_class = "shipclass_military"
                is_ship_size = "corvette"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_military"
                    is_ship_size = "corvette"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.k"
        custom_tooltip = "aoe_pirate_actions.6.k.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_destroyer_ships"
            any_owned_fleet = {
                is_ship_class = "shipclass_military"
                is_ship_size = "destroyer"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_military"
                    is_ship_size = "destroyer"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.l"
        custom_tooltip = "aoe_pirate_actions.6.l.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_cruiser_ships"
            any_owned_fleet = {
                is_ship_class = "shipclass_military"
                is_ship_size = "cruiser"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_military"
                    is_ship_size = "cruiser"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.m"
        custom_tooltip = "aoe_pirate_actions.6.m.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_battleship_ships"
            any_owned_fleet = {
                is_ship_class = "shipclass_military"
                is_ship_size = "battleship"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_military"
                    is_ship_size = "battleship"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.n"
        custom_tooltip = "aoe_pirate_actions.6.n.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_colossus_ships"
            any_owned_fleet = {
                is_ship_class = "shipclass_military"
                is_ship_size = "colossus"
            }
        }
        hidden_effect = {
            every_owned_ship = {
                limit = {
                    is_ship_class = "shipclass_military"
                    is_ship_size = "colossus"
                }
                if = {
                    limit = {
                        exists = leader
                    }
                    leader = {
                        unassign_leader = this
                    }
                }
                delete_ship = this
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.o"
        custom_tooltip = "aoe_pirate_actions.6.o.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_scientist_leaders"
            any_owned_leader = {
                leader_class = scientist
            }
        }
        hidden_effect = {
            every_owned_leader = {
                limit = {
                    leader_class = scientist
                }
                kill_leader = {
                    show_notification = no
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.p"
        custom_tooltip = "aoe_pirate_actions.6.p.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_admiral_leaders"
            any_owned_leader = {
                leader_class = admiral
            }
        }
        hidden_effect = {
            every_owned_leader = {
                limit = {
                    leader_class = admiral
                }
                kill_leader = {
                    show_notification = no
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.q"
        custom_tooltip = "aoe_pirate_actions.6.q.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_general_leaders"
            any_owned_leader = {
                leader_class = general
            }
        }
        hidden_effect = {
            every_owned_leader = {
                limit = {
                    leader_class = general
                }
                kill_leader = {
                    show_notification = no
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.r"
        custom_tooltip = "aoe_pirate_actions.6.r.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_governor_leaders"
            any_owned_leader = {
                leader_class = governor
            }
        }
        hidden_effect = {
            every_owned_leader = {
                limit = {
                    leader_class = governor
                }
                kill_leader = {
                    show_notification = no
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.s"
        custom_tooltip = "aoe_pirate_actions.6.s.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_system"
            exists = event_target:rebellion_pirate_target_system
            event_target:rebellion_pirate_target_system = {
                space_owner = {
                    is_same_value = root
                }
            }
        }
        hidden_effect = {
            event_target:rebellion_pirate_target_system = {
                every_system_planet = {
                    limit = {
                        is_colony = yes
                        OR = {
                            is_owned_by = root
                            is_controlled_by = root
                        }
                    }
                    destroy_colony = yes
                    create_ambient_object = {
                        type = explosion_particle_object
                        location = this
                        use_3d_location = yes
                        duration = 10
                        scale = 20
                    }
                }
                every_fleet_in_system = {
                    limit = {
                        exists = owner
                        owner = {
                            is_same_value = root
                        }
                    }
                    destroy_fleet = this
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.t"
        custom_tooltip = "aoe_pirate_actions.6.t.tooltip"
        ai_chance = {
            factor = 10
            modifier = {
                factor = 10
                has_ethic = "ethic_fanatic_pacifist"
            }
            modifier = {
                factor = 5
                has_ethic = "ethic_pacifist"
            }
            modifier = {
                factor = 10
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = inferior
                }
            }
            modifier = {
                factor = 5
                relative_power = {
                    who = event_target:rebellion_pirate_country
                    category = fleet
                    value = pathetic
                }
            }
        }
        trigger = {
            has_country_flag = "rebellion_pirate_demands_pops"
            exists = event_target:rebellion_pirate_target_planet
        }
        hidden_effect = {
            event_target:rebellion_pirate_target_planet = {
                every_owned_pop = {
                    limit = {
                        OR = {
                            is_unemployed = yes
                            is_enslaved = yes
                            is_being_purged = yes
                        }
                        happiness < 0.5
                    }
                    kill_pop = yes
                }
            }
        }
    }

    option = {
        name = "aoe_pirate_actions.6.z"
        custom_tooltip = "aoe_pirate_actions.6.z.tooltip"
        response_text = "aoe_pirate_actions.6.z.response"
        hidden_effect = {
            event_target:rebellion_pirate_country = {
                # Evasion counter
                if = {
                    limit = {
                        check_variable = {
                            which = "rebellion_pirate_evasion_counter"
                            value > 0
                        }
                    }
                    change_variable = {
                        which = "rebellion_pirate_evasion_counter"
                        value = 1
                    }
                }
                else = {
                    set_variable = {
                        which = "rebellion_pirate_evasion_counter"
                        value = 1
                    }
                }
                log = ">>> aoe_pirate_actions.6: evasion counter = [This.rebellion_pirate_evasion_counter]"
                # Fleets count
                set_variable = {
                    which = "rebellion_pirate_fleet_size_pool"
                    value = 1
                }
                while = {
                    limit = {
                        check_variable = {
                            which = "rebellion_pirate_evasion_counter"
                            value > 15
                        }
                    }
                    subtract_variable = {
                        which = "rebellion_pirate_evasion_counter"
                        value = 15
                    }
                    change_variable = {
                        which = "rebellion_pirate_fleet_size_pool"
                        value = 1
                    }
                }
                log = ">>> aoe_pirate_actions.6: fleets pool = [This.rebellion_pirate_fleet_size_pool]"
                # Available fleets
                every_owned_fleet = {
                    limit = {
                        has_fleet_flag = "rebellion_pirate_fleet_destroyer"
                    }
                    if = {
                        limit = {
                            root = {
                                check_variable = {
                                    which = "rebellion_pirate_fleet_size_pool"
                                    value > 0
                                }
                            }
                        }
                        root = {
                            subtract_variable = {
                                which = "rebellion_pirate_fleet_size_pool"
                                value = 1
                            }
                        }
                    }
                }
                log = ">>> aoe_pirate_actions.6: available fleets = [This.rebellion_pirate_fleet_size_pool]"
                # Create fleets
                set_variable = {
                    which = "rebellion_pirate_evasion_multiplier"
                    value = 0
                }
                while = {
                    limit = {
                        check_variable = {
                            which = "rebellion_pirate_fleet_size_pool"
                            value > 0
                        }
                    }
                    subtract_variable = {
                        which = "rebellion_pirate_fleet_size_pool"
                        value = 1
                    }
                    if = {
                        limit = {
                            check_variable = {
                                which = "rebellion_pirate_fleet_size_pool"
                                value > 0
                            }
                        }
                        change_variable = {
                            which = "rebellion_pirate_evasion_multiplier"
                            value = 1
                        }
                    }
                    create_leader = {
                        class = admiral
                        species = owner_main_species
                        name = random
                        skill = 1
                        immortal = yes
                        traits = {
                            trait = random_trait
                        }
                    }
                    last_created_leader = {
                        if = {
                            limit = {
                                prev = {
                                    has_country_flag = "fe_pirate"
                                }
                            }
                            add_skill = 9
                        }
                        else_if = {
                            limit = {
                                prev = {
                                    has_country_flag = "robot_pirate"
                                }
                            }
                            add_skill = 8
                        }
                        else_if = {
                            limit = {
                                prev = {
                                    has_country_flag = "lithoid_pirate"
                                }
                            }
                            add_skill = 7
                        }
                        else = {
                            random_list = {
                                1 = {
                                    add_skill = 9
                                }
                                2 = {
                                    add_skill = 8
                                }
                                5 = {
                                    add_skill = 7
                                }
                                10 = {
                                    add_skill = 6
                                }
                                25 = {
                                    add_skill = 5
                                }
                                10 = {
                                    add_skill = 4
                                }
                                5 = {
                                    add_skill = 3
                                }
                                2 = {
                                    add_skill = 2
                                }
                                1 = {
                                    add_skill = 1
                                }
                            }
                        }
                    }
                    create_fleet = {
                        name = "NAME_Pirate_Destroyer_Fleet"
                        effect = {
                            set_owner = prev
                            if = {
                                limit = {
                                    prev = {
                                        has_country_flag = "fe_pirate"
                                    }
                                }
                                random_list = {
                                    100 = {
                                        set_name = "NAME_Fallen_Empire_Pirate_Destroyer_Fleet_10"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                        create_pirate_ships_10 = yes
                                    }
                                    75 = {
                                        set_name = "NAME_Fallen_Empire_Pirate_Destroyer_Fleet_11"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                        create_pirate_ships_11 = yes
                                    }
                                    50 = {
                                        set_name = "NAME_Fallen_Empire_Pirate_Destroyer_Fleet_12"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                        create_pirate_ships_12 = yes
                                    }
                                    25 = {
                                        set_name = "NAME_Fallen_Empire_Pirate_Destroyer_Fleet_13"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                        create_pirate_ships_13 = yes
                                    }
                                    10 = {
                                        set_name = "NAME_Fallen_Empire_Pirate_Destroyer_Fleet_14"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                        create_pirate_ships_14 = yes
                                    }
                                    5 = {
                                        set_name = "NAME_Fallen_Empire_Pirate_Destroyer_Fleet_15"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                        create_pirate_ships_15 = yes
                                    }
                                }
                            }
                            else_if = {
                                limit = {
                                    prev = {
                                        has_country_flag = "robot_pirate"
                                    }
                                }
                                random_list = {
                                    100 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_9"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_9"
                                        create_pirate_ships_9 = yes
                                    }
                                    75 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_10"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                        create_pirate_ships_10 = yes
                                    }
                                    50 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_11"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                        create_pirate_ships_11 = yes
                                    }
                                    25 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_12"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                        create_pirate_ships_12 = yes
                                    }
                                    10 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_13"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                        create_pirate_ships_13 = yes
                                    }
                                    5 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_14"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                        create_pirate_ships_14 = yes
                                    }
                                    1 = {
                                        set_name = "NAME_Robot_Pirate_Destroyer_Fleet_15"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                        create_pirate_ships_15 = yes
                                    }
                                }
                            }
                            else_if = {
                                limit = {
                                    prev = {
                                        has_country_flag = "lithoid_pirate"
                                    }
                                }
                                random_list = {
                                    100 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_8"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_8"
                                        create_pirate_ships_8 = yes
                                    }
                                    75 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_9"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_9"
                                        create_pirate_ships_9 = yes
                                    }
                                    50 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_10"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                        create_pirate_ships_10 = yes
                                    }
                                    25 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_11"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                        create_pirate_ships_11 = yes
                                    }
                                    10 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_12"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                        create_pirate_ships_12 = yes
                                    }
                                    5 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_13"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                        create_pirate_ships_13 = yes
                                    }
                                    2 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_14"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                        create_pirate_ships_14 = yes
                                    }
                                    1 = {
                                        set_name = "NAME_Lithoid_Pirate_Destroyer_Fleet_15"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                        create_pirate_ships_15 = yes
                                    }
                                }
                            }
                            else = {
                                if = {
                                    limit = {
                                        prev = {
                                            check_variable = {
                                                which = "rebellion_pirate_fleet_size_pool"
                                                value > 0
                                            }
                                        }
                                    }
                                    set_name = "NAME_Pirate_Destroyer_Fleet_15"
                                    set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                    create_pirate_ships_15 = yes
                                }
                                else = {
                                    if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 2
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_2"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_2"
                                        create_pirate_ships_2 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 3
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_3"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_3"
                                        create_pirate_ships_3 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 4
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_4"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_4"
                                        create_pirate_ships_4 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 5
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_5"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_5"
                                        create_pirate_ships_5 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 6
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_6"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_6"
                                        create_pirate_ships_6 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 7
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_7"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_7"
                                        create_pirate_ships_7 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 8
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_8"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_8"
                                        create_pirate_ships_8 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 9
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_9"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_9"
                                        create_pirate_ships_9 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 10
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_10"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_10"
                                        create_pirate_ships_10 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 11
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_11"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_11"
                                        create_pirate_ships_11 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 12
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_12"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_12"
                                        create_pirate_ships_12 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 13
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_13"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_13"
                                        create_pirate_ships_13 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 14
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_14"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_14"
                                        create_pirate_ships_14 = yes
                                    }
                                    else_if = {
                                        limit = {
                                            prev = {
                                                check_variable = {
                                                    which = "rebellion_pirate_evasion_counter"
                                                    value = 15
                                                }
                                            }
                                        }
                                        set_name = "NAME_Pirate_Destroyer_Fleet_15"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_15"
                                        create_pirate_ships_15 = yes
                                    }
                                    else = {
                                        set_name = "NAME_Pirate_Destroyer_Fleet_1"
                                        set_fleet_flag = "rebellion_pirate_fleet_power_1"
                                        create_pirate_ships_1 = yes
                                    }
                                }
                            }
                            assign_leader = last_created_leader
                            set_location = {
                                target = event_target:rebellion_pirate_system.star
                                distance = 100
                                angle = random
                            }
                            set_fleet_stance = aggressive
                            set_aggro_range_measure_from = self
                            set_aggro_range = 800
                            set_fleet_flag = "rebellion_pirate_fleet_destroyer"
                        }
                        settings = {
                            uses_naval_capacity = no
                        }
                    }
                    log = ">>> aoe_pirate_actions.6: new fleet created"
                }
                while = {
                    limit = {
                        check_variable = {
                            which = "rebellion_pirate_evasion_multiplier"
                            value > 0
                        }
                    }
                    subtract_variable = {
                        which = "rebellion_pirate_evasion_multiplier"
                        value = 1
                    }
                    change_variable = {
                        which = "rebellion_pirate_evasion_counter"
                        value = 15
                    }
                }
                # Send fleets to the target system
                every_owned_fleet = {
                    limit = {
                        has_fleet_flag = "rebellion_pirate_fleet_destroyer"
                    }
                    clear_fleet_actions = this
                    fleet_event = {
                        id = aoe_pirate_actions.22
                        days = 30
                        random = 20
                    }
                }
            }
            log = ">>> aoe_pirate_actions.6: pirate fleet moved from [event_target:rebellion_pirate_system.GetName] system to [event_target:rebellion_pirate_target_system.GetName] system"
        }
    }
}

# Pirate country: patrol fleet won the battle
# This = owner of fleet 1 (combatant)
# From = owner of fleet 2 (destroyed)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
country_event = {
    id = aoe_pirate_actions.11
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        is_country_type = "rebellion_pirate"
        fromfrom = {
            has_fleet_flag = "rebellion_pirate_fleet_attacker"
        }
    }

    immediate = {
        random_owned_starbase = {
            fleet.solar_system = {
                star = {
                    save_event_target_as = rebellion_pirate_fleet_patrol_target
                }
            }
        }
        fromfrom = {
            clear_fleet_actions = this
            remove_fleet_flag = "rebellion_pirate_fleet_attacker"
            set_fleet_flag = "rebellion_pirate_fleet_patrol"
            if = {
                limit = {
                    has_hp_percentage < 0.75
                }
                auto_move_to_planet = {
                    target = event_target:rebellion_pirate_fleet_patrol_target
                    clear_auto_move_on_arrival = no
                    arrival_effect = rebellion_pirate_fleet_repair_effect
                }
            }
            else = {
                auto_move_to_planet = {
                    target = event_target:rebellion_pirate_fleet_patrol_target
                    clear_auto_move_on_arrival = no
                    arrival_effect = rebellion_pirate_fleet_patrol_effect
                }
            }
        }
    }
}

# Random country: country`s fleet won the battle against pirates fleet
# This = owner of fleet 1 (combatant)
# From = owner of fleet 2 (destroyed)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
country_event = {
    id = aoe_pirate_actions.12
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        from = {
            is_country_type = "rebellion_pirate"
        }
        fromfromfrom = {
            is_ship_class = "shipclass_military"
        }
    }

    immediate = {
        if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_15"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 3000
                    }
                }
            }
            add_resource = {
                influence = 800
                unity = 800
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_14"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 2800
                    }
                }
            }
            add_resource = {
                influence = 750
                unity = 750
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_13"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 2600
                    }
                }
            }
            add_resource = {
                influence = 700
                unity = 700
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_12"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 2400
                    }
                }
            }
            add_resource = {
                influence = 650
                unity = 650
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_11"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 2200
                    }
                }
            }
            add_resource = {
                influence = 600
                unity = 600
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_10"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 2000
                    }
                }
            }
            add_resource = {
                influence = 550
                unity = 550
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_9"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 1800
                    }
                }
            }
            add_resource = {
                influence = 500
                unity = 500
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_8"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 1600
                    }
                }
            }
            add_resource = {
                influence = 450
                unity = 450
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_7"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 1400
                    }
                }
            }
            add_resource = {
                influence = 400
                unity = 400
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_6"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 1200
                    }
                }
            }
            add_resource = {
                influence = 350
                unity = 350
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_5"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 1000
                    }
                }
            }
            add_resource = {
                influence = 300
                unity = 300
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_4"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 800
                    }
                }
            }
            add_resource = {
                influence = 250
                unity = 250
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_3"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 600
                    }
                }
            }
            add_resource = {
                influence = 200
                unity = 200
            }
        }
        else_if = {
            limit = {
                fromfromfrom = {
                    has_fleet_flag = "rebellion_pirate_fleet_power_2"
                }
            }
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 400
                    }
                }
            }
            add_resource = {
                influence = 150
                unity = 150
            }
        }
        else = {
            if = {
                limit = {
                    fromfrom = {
                        exists = leader
                    }
                }
                fromfrom = {
                    leader = {
                        add_experience = 200
                    }
                }
            }
            add_resource = {
                influence = 100
                unity = 100
            }
        }
    }
}

# Random country: establishing contacts with pirate country
ship_event = {
    id = aoe_pirate_actions.15
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        exists = owner
        OR = {
            from = {
                exists = starbase
                starbase = {
                    exists = owner
                    owner = {
                        is_country_type = "rebellion_pirate"
                        NOT = {
                            has_communications = fromfrom
                        }
                    }
                }
            }
            from = {
                any_neighbor_system = {
                    exists = starbase
                    starbase = {
                        exists = owner
                        owner = {
                            is_country_type = "rebellion_pirate"
                            NOT = {
                                has_communications = fromfrom
                            }
                        }
                    }
                }
            }
        }
    }

    immediate = {
        if = {
            limit = {
                from = {
                    exists = starbase
                    starbase = {
                        exists = owner
                        owner = {
                            is_country_type = "rebellion_pirate"
                        }
                    }
                }
            }
            from = {
                starbase = {
                    owner = {
                        establish_communications_no_message = fromfrom
                    }
                }
            }
        }
        else = {
            from = {
                random_neighbor_system = {
                    limit = {
                        exists = starbase
                        starbase = {
                            exists = owner
                            owner = {
                                is_country_type = "rebellion_pirate"
                            }
                        }
                    }
                    starbase = {
                        owner = {
                            establish_communications_no_message = fromfrom
                        }
                    }
                }
            }
        }
        log = ">>> aoe_pirate_actions.15: pirate country established communication with [FromFrom.GetName]"
    }
}

# Pirate fleet: patrol fleet actions
fleet_event = {
    id = aoe_pirate_actions.20
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        exists = this
        exists = owner
        has_fleet_flag = "rebellion_pirate_fleet_patrol"
    }

    immediate = {
        # Returning to base for repair
        if = {
            limit = {
                has_hp_percentage < 0.75
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_system.star
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_repair_effect
            }
        }
        else_if = { # Our home system is under attack
            limit = {
                NOT = {
                    solar_system = {
                        exists = space_owner
                        space_owner = {
                            is_same_value = root.owner
                        }
                    }
                }
                owner = {
                    any_owned_starbase = {
                        solar_system = {
                            any_ship_in_system = {
                                exists = owner
                                owner = {
                                    NOT = {
                                        is_same_value = root.owner
                                    }
                                }
                            }
                        }
                    }
                }
            }
            owner = {
                random_owned_starbase = {
                    limit = {
                        solar_system = {
                            any_ship_in_system = {
                                exists = owner
                                owner = {
                                    NOT = {
                                        is_same_value = root.owner
                                    }
                                }
                            }
                        }
                    }
                    solar_system = {
                        star = {
                            save_event_target_as = rebellion_pirate_fleet_patrol_target
                        }
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_patrol_effect
            }
        }
        else_if = { # We are in the system with hostile ships
            limit = {
                solar_system = {
                    any_ship_in_system = {
                        exists = owner
                        owner = {
                            NOR = {
                                is_same_value = root.owner
                                is_country_type = "rebellion_pirate"
                            }
                        }
                    }
                }
            }
            solar_system = {
                random_fleet_in_system = {
                    limit = {
                        exists = owner
                        owner = {
                            NOR = {
                                is_same_value = root.owner
                                is_country_type = "rebellion_pirate"
                            }
                        }
                    }
                    save_event_target_as = rebellion_pirate_fleet_attack_target
                }
            }
            remove_fleet_flag = "rebellion_pirate_fleet_patrol"
            set_fleet_flag = "rebellion_pirate_fleet_attacker"
            auto_follow_fleet = {
                target = event_target:rebellion_pirate_fleet_attack_target
                attack_fleet = yes
            }
        }
        else_if = { # We are in the neighbour habitable system and any planet in this system has an station
            limit = {
                solar_system = {
                    exists = space_owner
                    space_owner = {
                        NOT = {
                            is_same_value = root.owner
                        }
                    }
                    any_system_planet = {
                        OR = {
                            has_mining_station = yes
                            has_research_station = yes
                            has_observation_outpost = yes
                        }
                    }
                }
            }
            solar_system = {
                random_system_planet = {
                    limit = {
                        OR = {
                            has_mining_station = yes
                            has_research_station = yes
                            has_observation_outpost = yes
                        }
                    }
                    save_event_target_as = rebellion_pirate_fleet_patrol_target
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_patrol_effect
            }
        }
        else_if = { # We are in the home system and exists any neighbour system with any hostile ship
            limit = {
                solar_system = {
                    exists = space_owner
                    space_owner = {
                        is_same_value = root.owner
                    }
                    any_neighbor_system = {
                        any_ship_in_system = {
                            exists = owner
                            owner = {
                                NOT = {
                                    is_same_value = root.owner
                                }
                            }
                        }
                    }
                }
            }
            solar_system = {
                random_neighbor_system = {
                    limit = {
                        any_ship_in_system = {
                            exists = owner
                            owner = {
                                NOT = {
                                    is_same_value = root.owner
                                }
                            }
                        }
                    }
                    if = {
                        limit = {
                            any_ship_in_system = {
                                exists = owner
                                owner = {
                                    NOT = {
                                        is_same_value = root.owner
                                    }
                                }
                                exists = orbit
                            }
                        }
                        random_fleet_in_system = {
                            limit = {
                                exists = owner
                                owner = {
                                    NOT = {
                                        is_same_value = root.owner
                                    }
                                }
                                any_owned_ship = {
                                    exists = orbit
                                }
                            }
                            random_owned_ship = {
                                limit = {
                                    exists = orbit
                                }
                                orbit = {
                                    save_event_target_as = rebellion_pirate_fleet_patrol_target
                                }
                            }
                        }
                    }
                    else = {
                        star = {
                            save_event_target_as = rebellion_pirate_fleet_patrol_target
                        }
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_patrol_effect
            }
        }
        else_if = { # We are in the home system and exists any neighbour system
            limit = {
                solar_system = {
                    exists = space_owner
                    space_owner = {
                        is_same_value = root.owner
                    }
                    any_neighbor_system = {
                        always = yes
                    }
                }
            }
            random_list = {
                30 = {
                    modifier = {
                        factor = 0
                        NAND = {
                            exists = orbit
                            solar_system = {
                                any_system_planet = {
                                    NOT = {
                                        is_same_value = root.orbit
                                    }
                                }
                            }
                        }
                    }
                    modifier = {
                        factor = 3
                        NOT = {
                            solar_system = {
                                any_ship_in_system = {
                                    fleet = {
                                        NOT = {
                                            is_same_value = root
                                        }
                                    }
                                    exists = owner
                                    owner = {
                                        is_same_value = root.owner
                                    }
                                    exists = orbit
                                }
                            }
                        }
                    }
                    solar_system = {
                        random_system_planet = {
                            limit = {
                                NOT = {
                                    is_same_value = root.orbit
                                }
                            }
                            save_event_target_as = rebellion_pirate_fleet_patrol_target
                        }
                    }
                }
                70 = {
                    solar_system = {
                        random_neighbor_system = {
                            star = {
                                save_event_target_as = rebellion_pirate_fleet_patrol_target
                            }
                        }
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_patrol_effect
            }
        }
        else_if = { # We are in the orbit of any planet in our home system and no one neighbour system exists
            limit = {
                solar_system = {
                    exists = space_owner
                    space_owner = {
                        is_same_value = root.owner
                    }
                }
            }
            if = {
                limit = {
                    exists = orbit
                }
                if = {
                    limit = {
                        solar_system = {
                            any_system_planet = {
                                NOT = {
                                    is_same_value = root.orbit
                                }
                            }
                        }
                    }
                    solar_system = {
                        random_system_planet = {
                            limit = {
                                NOT = {
                                    is_same_value = root.orbit
                                }
                            }
                            save_event_target_as = rebellion_pirate_fleet_patrol_target
                        }
                    }
                }
            }
            else = {
                solar_system = {
                    random_system_planet = {
                        save_event_target_as = rebellion_pirate_fleet_patrol_target
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_patrol_effect
            }
        }
        else_if = { # We are in the neighbour system
            limit = {
                solar_system = {
                    any_neighbor_system = {
                        exists = space_owner
                        space_owner = {
                            is_same_value = root.owner
                        }
                    }
                }
            }
            random_list = {
                70 = {
                    modifier = {
                        factor = 0
                        NAND = {
                            exists = orbit
                            solar_system = {
                                any_system_planet = {
                                    NOT = {
                                        is_same_value = root.orbit
                                    }
                                }
                            }
                        }
                    }
                    solar_system = {
                        random_system_planet = {
                            limit = {
                                NOT = {
                                    is_same_value = root.orbit
                                }
                            }
                            save_event_target_as = rebellion_pirate_fleet_patrol_target
                        }
                    }
                }
                30 = {
                    solar_system = {
                        random_neighbor_system = {
                            limit = {
                                exists = space_owner
                                space_owner = {
                                    is_same_value = root.owner
                                }
                            }
                            random_system_planet = {
                                save_event_target_as = rebellion_pirate_fleet_patrol_target
                            }
                        }
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_patrol_effect
            }
        }
        else_if = { # Where we are?
            limit = {
                solar_system = {
                    closest_system = {
                        limit = {
                            exists = space_owner
                            space_owner = {
                                is_same_value = root.owner
                            }
                            exists = spaceport
                            spaceport = {
                                exists = owner
                                owner = {
                                    is_same_value = root.owner
                                }
                            }
                        }
                        max_steps = 15
                    }
                }
            }
            solar_system = {
                closest_system = {
                    limit = {
                        exists = space_owner
                        space_owner = {
                            is_same_value = root.owner
                        }
                        exists = spaceport
                        spaceport = {
                            exists = owner
                            owner = {
                                is_same_value = root.owner
                            }
                        }
                    }
                    max_steps = 15
                    star = {
                        save_event_target_as = rebellion_pirate_fleet_patrol_target
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_patrol_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_repair_effect
            }
        }
    }
}

# Pirate fleet: patrol fleet repaired
fleet_event = {
    id = aoe_pirate_actions.21
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        exists = owner
    }

    immediate = {
        owner = {
            every_owned_ship = {
                limit = {
                    exists = fleet
                    fleet = {
                        is_same_value = root
                    }
                }
                set_disabled = no
                repair_ship = yes
            }
        }

        fleet_event = {
            id = aoe_pirate_actions.20
            days = 2
        }
    }
}

# Pirate fleet: attacking fleet actions
fleet_event = {
    id = aoe_pirate_actions.22
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        has_fleet_flag = "rebellion_pirate_fleet_destroyer"
    }

    immediate = {
        # We are in the target system and in the system exists any mining station
        if = {
            limit = {
                exists = owner
                solar_system = {
                    has_star_flag = rebellion_pirate_target_system@root.owner
                    any_system_planet = {
                        OR = {
                            has_mining_station = yes
                            has_research_station = yes
                            has_observation_outpost = yes
                        }
                    }
                }
            }
            solar_system = {
                random_system_planet = {
                    limit = {
                        OR = {
                            has_mining_station = yes
                            has_research_station = yes
                            has_observation_outpost = yes
                        }
                    }
                    save_event_target_as = rebellion_pirate_fleet_destroyer_target
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 1st"
        }
        else_if = { # We are in the target system or target`s neighbor system and in the neighbor system exists target`s hostile fleet
            limit = {
                exists = owner
                solar_system = {
                    any_neighbor_system = {
                        any_ship_in_system = {
                            exists = owner
                            owner = {
                                has_country_flag = rebellion_pirate_target_country@root.owner
                            }
                        }
                        OR = {
                            has_star_flag = rebellion_pirate_target_system@root.owner
                            any_neighbor_system = {
                                has_star_flag = rebellion_pirate_target_system@root.owner
                            }
                        }
                    }
                }
            }
            solar_system = {
                random_neighbor_system = {
                    limit = {
                        any_ship_in_system = {
                            exists = owner
                            owner = {
                                has_country_flag = rebellion_pirate_target_country@root.owner
                            }
                        }
                        OR = {
                            has_star_flag = rebellion_pirate_target_system@root.owner
                            any_neighbor_system = {
                                has_star_flag = rebellion_pirate_target_system@root.owner
                            }
                        }
                    }
                    if = {
                        limit = {
                            any_ship_in_system = {
                                exists = orbit
                                exists = owner
                                owner = {
                                    has_country_flag = rebellion_pirate_target_country@root.owner
                                }
                            }
                        }
                        random_fleet_in_system = {
                            limit = {
                                exists = owner
                                owner = {
                                    has_country_flag = rebellion_pirate_target_country@root.owner
                                }
                                any_owned_ship = {
                                    exists = orbit
                                }
                            }
                            orbit = {
                                save_event_target_as = rebellion_pirate_fleet_destroyer_target
                            }
                        }
                    }
                    else = {
                        star = {
                            save_event_target_as = rebellion_pirate_fleet_destroyer_target
                        }
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 2rd"
        }
        else_if = { # We are in the target system and any neighbor system belongs to target country
            limit = {
                exists = owner
                solar_system = {
                    has_star_flag = rebellion_pirate_target_system@root.owner
                    any_neighbor_system = {
                        exists = space_owner
                        space_owner = {
                            has_country_flag = rebellion_pirate_target_country@root.owner
                        }
                    }
                }
            }
            solar_system = {
                random_neighbor_system = {
                    limit = {
                        exists = space_owner
                        space_owner = {
                            has_country_flag = rebellion_pirate_target_country@root.owner
                        }
                    }
                    star = {
                        save_event_target_as = rebellion_pirate_fleet_destroyer_target
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 3rd"
        }
        else_if = { # We are in the target`s neighbor system and in the system exists any mining station
            limit = {
                exists = owner
                solar_system = {
                    exists = space_owner
                    space_owner = {
                        has_country_flag = rebellion_pirate_target_country@root.owner
                    }
                    any_neighbor_system = {
                        has_star_flag = rebellion_pirate_target_system@root.owner
                    }
                    any_system_planet = {
                        OR = {
                            has_mining_station = yes
                            has_research_station = yes
                            has_observation_outpost = yes
                        }
                    }
                }
            }
            solar_system = {
                random_system_planet = {
                    limit = {
                        OR = {
                            has_mining_station = yes
                            has_research_station = yes
                            has_observation_outpost = yes
                        }
                    }
                    save_event_target_as = rebellion_pirate_fleet_destroyer_target
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 4rt"
        }
        else_if = { # We are in the orbit of any planet in the target system
            limit = {
                exists = owner
                exists = orbit
                solar_system = {
                    has_star_flag = rebellion_pirate_target_system@root.owner
                }
            }
            solar_system = {
                random_system_planet = {
                    limit = {
                        NOT = {
                            is_same_value = root.orbit
                        }
                    }
                    save_event_target_as = rebellion_pirate_fleet_destroyer_target
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 5th"
        }
        else_if = { # We are somewhere in the target system
            limit = {
                exists = owner
                solar_system = {
                    has_star_flag = rebellion_pirate_target_system@root.owner
                }
            }
            solar_system = {
                random_system_planet = {
                    save_event_target_as = rebellion_pirate_fleet_destroyer_target
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 6th"
        }
        else_if = { # We are not in the target system, but that`s system exists
            limit = {
                exists = owner
                owner = {
                    any_country = {
                        has_country_flag = rebellion_pirate_target_country@root.owner
                        any_system_within_border = {
                            has_star_flag = rebellion_pirate_target_system@root.owner
                        }
                    }
                }
            }
            owner = {
                random_country = {
                    limit = {
                        has_country_flag = rebellion_pirate_target_country@root.owner
                    }
                    random_system_within_border = {
                        limit = {
                            has_star_flag = rebellion_pirate_target_system@root.owner
                        }
                        star = {
                            save_event_target_as = rebellion_pirate_fleet_destroyer_target
                        }
                    }
                }
            }
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_destroy_effect
            }
            log = ">>> aoe_pirate_actions.22: 7th"
        }
        else_if = { # Target does not exists and we are returning to base
            limit = {
                exists = owner
                owner = {
                    any_owned_starbase = {
                        always = yes
                    }
                }
            }
            owner = {
                random_owned_starbase = {
                    fleet.solar_system = {
                        star = {
                            save_event_target_as = rebellion_pirate_fleet_destroyer_target
                        }
                    }
                }
            }
            remove_fleet_flag = "rebellion_pirate_fleet_destroyer"
            auto_move_to_planet = {
                target = event_target:rebellion_pirate_fleet_destroyer_target
                clear_auto_move_on_arrival = no
                arrival_effect = rebellion_pirate_fleet_dismiss_effect
            }
            log = ">>> aoe_pirate_actions.22: 8th"
        }
        else = {
            log = ">>> aoe_pirate_actions.22: error"
        }
    }
}

# Pirate fleet: attacking fleet dismissed
fleet_event = {
    id = aoe_pirate_actions.23
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        delete_fleet = this
    }
}