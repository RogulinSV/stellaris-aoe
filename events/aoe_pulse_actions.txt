namespace = aoe_pulse_actions

event = {
    id = aoe_pulse_actions.1
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        every_playable_country = {
            random_owned_planet = {
                limit = {
                    has_modifier = "planet_interstellar_research"
                }
                while = {
                    count = 2
                    closest_system = {
                        min_steps = 0
                        max_steps = 16
                        limit = {
                            any_system_planet = {
                                OR = {
                                    habitable_planet = yes
                                    is_colony = yes
                                    is_capital = yes
                                    is_colonizable = yes
                                }
                                NOT = {
                                    is_same_value = prevprev
                                }
                                OR = {
                                    has_owner = no
                                    owner = {
                                        is_same_value = prevprevprev
                                    }
                                }
                                # is_surveyed = {
                                #     who = prevprevprev
                                #     status = yes
                                # }
                            }
                        }
                        random_system_planet = {
                            limit = {
                                OR = {
                                    habitable_planet = yes
                                    is_colony = yes
                                    is_capital = yes
                                    is_colonizable = yes
                                }
                                NOT = {
                                    is_same_value = prevprev
                                }
                                OR = {
                                    has_owner = no
                                    owner = {
                                        is_same_value = prevprevprev
                                    }
                                }
                                # is_surveyed = {
                                #    who = prevprevprev
                                #    status = yes
                                # }
                            }
                            planet_event = {
                                id = aoe_pulse_actions.2
                                days = 360
                                random = 180
                            }

                            log = "aoe_pulse_actions.1: Planet «[This.GetName]» from «[Prev.GetName]» system was selected for adding deposits"
                        }
                    }
                }

                log = "aoe_pulse_actions.1: Origin planet is «[This.GetName]» from «[This.solar_system.GetName]» system"
            }

            log = "aoe_pulse_actions.1: Origin country is «[This.GetName]»"
        }
    }
}

planet_event = {
    id = aoe_pulse_actions.2
    title = aoe_pulse_actions.2.title
    desc = aoe_pulse_actions.2.desc
    picture = GFX_aoe_planet_deposits_discovered
    show_sound = event_laboratory_sound
    is_triggered_only = yes
    hide_window = no
    location = this

    immediate = {
        add_deposit = "d_crystallized_hills"
        add_deposit = "d_metallized_mountains"
        add_deposit = "d_crystallized_plains"
        add_deposit = "d_metallized_oceans"
        add_deposit = "d_crystallized_stratums"
        add_deposit = "d_metallized_mines"

        log = "aoe_pulse_actions.2: Deposits added into the planet «[This.GetName]» from «[This.solar_system.GetName]» system"
    }

    option = {
        name = aoe_pulse_actions.2.a
        custom_tooltip = aoe_pulse_actions.2.a.tooltip
    }
}